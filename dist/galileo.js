!function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=9)}([function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"EPSILON",function(){return d}),e.d(r,"ARRAY_TYPE",function(){return v}),e.d(r,"RANDOM",function(){return m}),e.d(r,"setMatrixArrayType",function(){return _}),e.d(r,"toRadian",function(){return g}),e.d(r,"equals",function(){return M});var i={};e.r(i),e.d(i,"create",function(){return b}),e.d(i,"clone",function(){return x}),e.d(i,"copy",function(){return A}),e.d(i,"identity",function(){return w}),e.d(i,"fromValues",function(){return y}),e.d(i,"set",function(){return E}),e.d(i,"transpose",function(){return R}),e.d(i,"invert",function(){return T}),e.d(i,"adjoint",function(){return F}),e.d(i,"determinant",function(){return L}),e.d(i,"multiply",function(){return P}),e.d(i,"rotate",function(){return S}),e.d(i,"scale",function(){return O}),e.d(i,"fromRotation",function(){return D}),e.d(i,"fromScaling",function(){return U}),e.d(i,"str",function(){return I}),e.d(i,"frob",function(){return B}),e.d(i,"LDU",function(){return V}),e.d(i,"add",function(){return C}),e.d(i,"subtract",function(){return q}),e.d(i,"exactEquals",function(){return z}),e.d(i,"equals",function(){return j}),e.d(i,"multiplyScalar",function(){return k}),e.d(i,"multiplyScalarAndAdd",function(){return N}),e.d(i,"mul",function(){return Y}),e.d(i,"sub",function(){return G});var o={};e.r(o),e.d(o,"create",function(){return H}),e.d(o,"clone",function(){return X}),e.d(o,"copy",function(){return K}),e.d(o,"identity",function(){return W}),e.d(o,"fromValues",function(){return $}),e.d(o,"set",function(){return Q}),e.d(o,"invert",function(){return Z}),e.d(o,"determinant",function(){return J}),e.d(o,"multiply",function(){return tt}),e.d(o,"rotate",function(){return nt}),e.d(o,"scale",function(){return et}),e.d(o,"translate",function(){return rt}),e.d(o,"fromRotation",function(){return it}),e.d(o,"fromScaling",function(){return ot}),e.d(o,"fromTranslation",function(){return at}),e.d(o,"str",function(){return st}),e.d(o,"frob",function(){return ut}),e.d(o,"add",function(){return ct}),e.d(o,"subtract",function(){return ht}),e.d(o,"multiplyScalar",function(){return ft}),e.d(o,"multiplyScalarAndAdd",function(){return lt}),e.d(o,"exactEquals",function(){return dt}),e.d(o,"equals",function(){return vt}),e.d(o,"mul",function(){return mt}),e.d(o,"sub",function(){return _t});var a={};e.r(a),e.d(a,"create",function(){return pt}),e.d(a,"fromMat4",function(){return gt}),e.d(a,"clone",function(){return Mt}),e.d(a,"copy",function(){return bt}),e.d(a,"fromValues",function(){return xt}),e.d(a,"set",function(){return At}),e.d(a,"identity",function(){return wt}),e.d(a,"transpose",function(){return yt}),e.d(a,"invert",function(){return Et}),e.d(a,"adjoint",function(){return Rt}),e.d(a,"determinant",function(){return Tt}),e.d(a,"multiply",function(){return Ft}),e.d(a,"translate",function(){return Lt}),e.d(a,"rotate",function(){return Pt}),e.d(a,"scale",function(){return St}),e.d(a,"fromTranslation",function(){return Ot}),e.d(a,"fromRotation",function(){return Dt}),e.d(a,"fromScaling",function(){return Ut}),e.d(a,"fromMat2d",function(){return It}),e.d(a,"fromQuat",function(){return Bt}),e.d(a,"normalFromMat4",function(){return Vt}),e.d(a,"projection",function(){return Ct}),e.d(a,"str",function(){return qt}),e.d(a,"frob",function(){return zt}),e.d(a,"add",function(){return jt}),e.d(a,"subtract",function(){return kt}),e.d(a,"multiplyScalar",function(){return Nt}),e.d(a,"multiplyScalarAndAdd",function(){return Yt}),e.d(a,"exactEquals",function(){return Gt}),e.d(a,"equals",function(){return Ht}),e.d(a,"mul",function(){return Xt}),e.d(a,"sub",function(){return Kt});var s={};e.r(s),e.d(s,"create",function(){return Wt}),e.d(s,"clone",function(){return $t}),e.d(s,"copy",function(){return Qt}),e.d(s,"fromValues",function(){return Zt}),e.d(s,"set",function(){return Jt}),e.d(s,"identity",function(){return tn}),e.d(s,"transpose",function(){return nn}),e.d(s,"invert",function(){return en}),e.d(s,"adjoint",function(){return rn}),e.d(s,"determinant",function(){return on}),e.d(s,"multiply",function(){return an}),e.d(s,"translate",function(){return sn}),e.d(s,"scale",function(){return un}),e.d(s,"rotate",function(){return cn}),e.d(s,"rotateX",function(){return hn}),e.d(s,"rotateY",function(){return fn}),e.d(s,"rotateZ",function(){return ln}),e.d(s,"fromTranslation",function(){return dn}),e.d(s,"fromScaling",function(){return vn}),e.d(s,"fromRotation",function(){return mn}),e.d(s,"fromXRotation",function(){return _n}),e.d(s,"fromYRotation",function(){return pn}),e.d(s,"fromZRotation",function(){return gn}),e.d(s,"fromRotationTranslation",function(){return Mn}),e.d(s,"fromQuat2",function(){return bn}),e.d(s,"getTranslation",function(){return xn}),e.d(s,"getScaling",function(){return An}),e.d(s,"getRotation",function(){return wn}),e.d(s,"fromRotationTranslationScale",function(){return yn}),e.d(s,"fromRotationTranslationScaleOrigin",function(){return En}),e.d(s,"fromQuat",function(){return Rn}),e.d(s,"frustum",function(){return Tn}),e.d(s,"perspective",function(){return Fn}),e.d(s,"perspectiveFromFieldOfView",function(){return Ln}),e.d(s,"ortho",function(){return Pn}),e.d(s,"lookAt",function(){return Sn}),e.d(s,"targetTo",function(){return On}),e.d(s,"str",function(){return Dn}),e.d(s,"frob",function(){return Un}),e.d(s,"add",function(){return In}),e.d(s,"subtract",function(){return Bn}),e.d(s,"multiplyScalar",function(){return Vn}),e.d(s,"multiplyScalarAndAdd",function(){return Cn}),e.d(s,"exactEquals",function(){return qn}),e.d(s,"equals",function(){return zn}),e.d(s,"mul",function(){return jn}),e.d(s,"sub",function(){return kn});var u={};e.r(u),e.d(u,"create",function(){return Nn}),e.d(u,"clone",function(){return Yn}),e.d(u,"length",function(){return Gn}),e.d(u,"fromValues",function(){return Hn}),e.d(u,"copy",function(){return Xn}),e.d(u,"set",function(){return Kn}),e.d(u,"add",function(){return Wn}),e.d(u,"subtract",function(){return $n}),e.d(u,"multiply",function(){return Qn}),e.d(u,"divide",function(){return Zn}),e.d(u,"ceil",function(){return Jn}),e.d(u,"floor",function(){return te}),e.d(u,"min",function(){return ne}),e.d(u,"max",function(){return ee}),e.d(u,"round",function(){return re}),e.d(u,"scale",function(){return ie}),e.d(u,"scaleAndAdd",function(){return oe}),e.d(u,"distance",function(){return ae}),e.d(u,"squaredDistance",function(){return se}),e.d(u,"squaredLength",function(){return ue}),e.d(u,"negate",function(){return ce}),e.d(u,"inverse",function(){return he}),e.d(u,"normalize",function(){return fe}),e.d(u,"dot",function(){return le}),e.d(u,"cross",function(){return de}),e.d(u,"lerp",function(){return ve}),e.d(u,"hermite",function(){return me}),e.d(u,"bezier",function(){return _e}),e.d(u,"random",function(){return pe}),e.d(u,"transformMat4",function(){return ge}),e.d(u,"transformMat3",function(){return Me}),e.d(u,"transformQuat",function(){return be}),e.d(u,"rotateX",function(){return xe}),e.d(u,"rotateY",function(){return Ae}),e.d(u,"rotateZ",function(){return we}),e.d(u,"angle",function(){return ye}),e.d(u,"str",function(){return Ee}),e.d(u,"exactEquals",function(){return Re}),e.d(u,"equals",function(){return Te}),e.d(u,"sub",function(){return Fe}),e.d(u,"mul",function(){return Le}),e.d(u,"div",function(){return Pe}),e.d(u,"dist",function(){return Se}),e.d(u,"sqrDist",function(){return Oe}),e.d(u,"len",function(){return De}),e.d(u,"sqrLen",function(){return Ue}),e.d(u,"forEach",function(){return Ie});var c={};e.r(c),e.d(c,"create",function(){return Be}),e.d(c,"clone",function(){return Ve}),e.d(c,"fromValues",function(){return Ce}),e.d(c,"copy",function(){return qe}),e.d(c,"set",function(){return ze}),e.d(c,"add",function(){return je}),e.d(c,"subtract",function(){return ke}),e.d(c,"multiply",function(){return Ne}),e.d(c,"divide",function(){return Ye}),e.d(c,"ceil",function(){return Ge}),e.d(c,"floor",function(){return He}),e.d(c,"min",function(){return Xe}),e.d(c,"max",function(){return Ke}),e.d(c,"round",function(){return We}),e.d(c,"scale",function(){return $e}),e.d(c,"scaleAndAdd",function(){return Qe}),e.d(c,"distance",function(){return Ze}),e.d(c,"squaredDistance",function(){return Je}),e.d(c,"length",function(){return tr}),e.d(c,"squaredLength",function(){return nr}),e.d(c,"negate",function(){return er}),e.d(c,"inverse",function(){return rr}),e.d(c,"normalize",function(){return ir}),e.d(c,"dot",function(){return or}),e.d(c,"lerp",function(){return ar}),e.d(c,"random",function(){return sr}),e.d(c,"transformMat4",function(){return ur}),e.d(c,"transformQuat",function(){return cr}),e.d(c,"str",function(){return hr}),e.d(c,"exactEquals",function(){return fr}),e.d(c,"equals",function(){return lr}),e.d(c,"sub",function(){return dr}),e.d(c,"mul",function(){return vr}),e.d(c,"div",function(){return mr}),e.d(c,"dist",function(){return _r}),e.d(c,"sqrDist",function(){return pr}),e.d(c,"len",function(){return gr}),e.d(c,"sqrLen",function(){return Mr}),e.d(c,"forEach",function(){return br});var h={};e.r(h),e.d(h,"create",function(){return xr}),e.d(h,"identity",function(){return Ar}),e.d(h,"setAxisAngle",function(){return wr}),e.d(h,"getAxisAngle",function(){return yr}),e.d(h,"multiply",function(){return Er}),e.d(h,"rotateX",function(){return Rr}),e.d(h,"rotateY",function(){return Tr}),e.d(h,"rotateZ",function(){return Fr}),e.d(h,"calculateW",function(){return Lr}),e.d(h,"slerp",function(){return Pr}),e.d(h,"random",function(){return Sr}),e.d(h,"invert",function(){return Or}),e.d(h,"conjugate",function(){return Dr}),e.d(h,"fromMat3",function(){return Ur}),e.d(h,"fromEuler",function(){return Ir}),e.d(h,"str",function(){return Br}),e.d(h,"clone",function(){return Vr}),e.d(h,"fromValues",function(){return Cr}),e.d(h,"copy",function(){return qr}),e.d(h,"set",function(){return zr}),e.d(h,"add",function(){return jr}),e.d(h,"mul",function(){return kr}),e.d(h,"scale",function(){return Nr}),e.d(h,"dot",function(){return Yr}),e.d(h,"lerp",function(){return Gr}),e.d(h,"length",function(){return Hr}),e.d(h,"len",function(){return Xr}),e.d(h,"squaredLength",function(){return Kr}),e.d(h,"sqrLen",function(){return Wr}),e.d(h,"normalize",function(){return $r}),e.d(h,"exactEquals",function(){return Qr}),e.d(h,"equals",function(){return Zr}),e.d(h,"rotationTo",function(){return Jr}),e.d(h,"sqlerp",function(){return ti}),e.d(h,"setAxes",function(){return ni});var f={};e.r(f),e.d(f,"create",function(){return ei}),e.d(f,"clone",function(){return ri}),e.d(f,"fromValues",function(){return ii}),e.d(f,"fromRotationTranslationValues",function(){return oi}),e.d(f,"fromRotationTranslation",function(){return ai}),e.d(f,"fromTranslation",function(){return si}),e.d(f,"fromRotation",function(){return ui}),e.d(f,"fromMat4",function(){return ci}),e.d(f,"copy",function(){return hi}),e.d(f,"identity",function(){return fi}),e.d(f,"set",function(){return li}),e.d(f,"getReal",function(){return di}),e.d(f,"getDual",function(){return vi}),e.d(f,"setReal",function(){return mi}),e.d(f,"setDual",function(){return _i}),e.d(f,"getTranslation",function(){return pi}),e.d(f,"translate",function(){return gi}),e.d(f,"rotateX",function(){return Mi}),e.d(f,"rotateY",function(){return bi}),e.d(f,"rotateZ",function(){return xi}),e.d(f,"rotateByQuatAppend",function(){return Ai}),e.d(f,"rotateByQuatPrepend",function(){return wi}),e.d(f,"rotateAroundAxis",function(){return yi}),e.d(f,"add",function(){return Ei}),e.d(f,"multiply",function(){return Ri}),e.d(f,"mul",function(){return Ti}),e.d(f,"scale",function(){return Fi}),e.d(f,"dot",function(){return Li}),e.d(f,"lerp",function(){return Pi}),e.d(f,"invert",function(){return Si}),e.d(f,"conjugate",function(){return Oi}),e.d(f,"length",function(){return Di}),e.d(f,"len",function(){return Ui}),e.d(f,"squaredLength",function(){return Ii}),e.d(f,"sqrLen",function(){return Bi}),e.d(f,"normalize",function(){return Vi}),e.d(f,"str",function(){return Ci}),e.d(f,"exactEquals",function(){return qi}),e.d(f,"equals",function(){return zi});var l={};e.r(l),e.d(l,"create",function(){return ji}),e.d(l,"clone",function(){return ki}),e.d(l,"fromValues",function(){return Ni}),e.d(l,"copy",function(){return Yi}),e.d(l,"set",function(){return Gi}),e.d(l,"add",function(){return Hi}),e.d(l,"subtract",function(){return Xi}),e.d(l,"multiply",function(){return Ki}),e.d(l,"divide",function(){return Wi}),e.d(l,"ceil",function(){return $i}),e.d(l,"floor",function(){return Qi}),e.d(l,"min",function(){return Zi}),e.d(l,"max",function(){return Ji}),e.d(l,"round",function(){return to}),e.d(l,"scale",function(){return no}),e.d(l,"scaleAndAdd",function(){return eo}),e.d(l,"distance",function(){return ro}),e.d(l,"squaredDistance",function(){return io}),e.d(l,"length",function(){return oo}),e.d(l,"squaredLength",function(){return ao}),e.d(l,"negate",function(){return so}),e.d(l,"inverse",function(){return uo}),e.d(l,"normalize",function(){return co}),e.d(l,"dot",function(){return ho}),e.d(l,"cross",function(){return fo}),e.d(l,"lerp",function(){return lo}),e.d(l,"random",function(){return vo}),e.d(l,"transformMat2",function(){return mo}),e.d(l,"transformMat2d",function(){return _o}),e.d(l,"transformMat3",function(){return po}),e.d(l,"transformMat4",function(){return go}),e.d(l,"rotate",function(){return Mo}),e.d(l,"angle",function(){return bo}),e.d(l,"str",function(){return xo}),e.d(l,"exactEquals",function(){return Ao}),e.d(l,"equals",function(){return wo}),e.d(l,"len",function(){return yo}),e.d(l,"sub",function(){return Eo}),e.d(l,"mul",function(){return Ro}),e.d(l,"div",function(){return To}),e.d(l,"dist",function(){return Fo}),e.d(l,"sqrDist",function(){return Lo}),e.d(l,"sqrLen",function(){return Po}),e.d(l,"forEach",function(){return So});var d=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function _(t){v=t}var p=Math.PI/180;function g(t){return t*p}function M(t,n){return Math.abs(t-n)<=d*Math.max(1,Math.abs(t),Math.abs(n))}function b(){var t=new v(4);return v!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function x(t){var n=new v(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function A(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function w(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function y(t,n,e,r){var i=new v(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function E(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function R(t,n){if(t===n){var e=n[1];t[1]=n[2],t[2]=e}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function T(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=e*a,t):null}function F(t,n){var e=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=e,t}function L(t){return t[0]*t[3]-t[2]*t[1]}function P(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=r*c+o*h,t[3]=i*c+a*h,t}function S(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t}function O(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1];return t[0]=r*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t}function D(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t}function U(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function I(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function B(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function V(t,n,e,r){return t[2]=r[2]/r[0],e[0]=r[0],e[1]=r[1],e[3]=r[3]-t[2]*e[1],[t,n,e]}function C(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function q(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function z(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function j(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=n[0],s=n[1],u=n[2],c=n[3];return Math.abs(e-a)<=d*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=d*Math.max(1,Math.abs(o),Math.abs(c))}function k(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function N(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}var Y=P,G=q;function H(){var t=new v(6);return v!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function X(t){var n=new v(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function K(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function W(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function $(t,n,e,r,i,o){var a=new v(6);return a[0]=t,a[1]=n,a[2]=e,a[3]=r,a[4]=i,a[5]=o,a}function Q(t,n,e,r,i,o,a){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t}function Z(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=e*o-r*i;return u?(u=1/u,t[0]=o*u,t[1]=-r*u,t[2]=-i*u,t[3]=e*u,t[4]=(i*s-o*a)*u,t[5]=(r*a-e*s)*u,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=e[0],h=e[1],f=e[2],l=e[3],d=e[4],v=e[5];return t[0]=r*c+o*h,t[1]=i*c+a*h,t[2]=r*f+o*l,t[3]=i*f+a*l,t[4]=r*d+o*v+s,t[5]=i*d+a*v+u,t}function nt(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=Math.sin(e),h=Math.cos(e);return t[0]=r*h+o*c,t[1]=i*h+a*c,t[2]=r*-c+o*h,t[3]=i*-c+a*h,t[4]=s,t[5]=u,t}function et(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=e[0],h=e[1];return t[0]=r*c,t[1]=i*c,t[2]=o*h,t[3]=a*h,t[4]=s,t[5]=u,t}function rt(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=e[0],h=e[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*c+o*h+s,t[5]=i*c+a*h+u,t}function it(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=-e,t[3]=r,t[4]=0,t[5]=0,t}function ot(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function at(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function ct(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t}function ht(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t}function ft(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t}function lt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t}function dt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]}function vt(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=n[0],c=n[1],h=n[2],f=n[3],l=n[4],v=n[5];return Math.abs(e-u)<=d*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(r-c)<=d*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=d*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-l)<=d*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-v)<=d*Math.max(1,Math.abs(s),Math.abs(v))}var mt=tt,_t=ht;function pt(){var t=new v(9);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function gt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function Mt(t){var n=new v(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function bt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function xt(t,n,e,r,i,o,a,s,u){var c=new v(9);return c[0]=t,c[1]=n,c[2]=e,c[3]=r,c[4]=i,c[5]=o,c[6]=a,c[7]=s,c[8]=u,c}function At(t,n,e,r,i,o,a,s,u,c){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t}function wt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function yt(t,n){if(t===n){var e=n[1],r=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=e,t[5]=n[7],t[6]=r,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function Et(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=h*a-s*c,l=-h*o+s*u,d=c*o-a*u,v=e*f+r*l+i*d;return v?(v=1/v,t[0]=f*v,t[1]=(-h*r+i*c)*v,t[2]=(s*r-i*a)*v,t[3]=l*v,t[4]=(h*e-i*u)*v,t[5]=(-s*e+i*o)*v,t[6]=d*v,t[7]=(-c*e+r*u)*v,t[8]=(a*e-r*o)*v,t):null}function Rt(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],c=n[7],h=n[8];return t[0]=a*h-s*c,t[1]=i*c-r*h,t[2]=r*s-i*a,t[3]=s*u-o*h,t[4]=e*h-i*u,t[5]=i*o-e*s,t[6]=o*c-a*u,t[7]=r*u-e*c,t[8]=e*a-r*o,t}function Tt(t){var n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return n*(c*o-a*u)+e*(-c*i+a*s)+r*(u*i-o*s)}function Ft(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1],v=e[2],m=e[3],_=e[4],p=e[5],g=e[6],M=e[7],b=e[8];return t[0]=l*r+d*a+v*c,t[1]=l*i+d*s+v*h,t[2]=l*o+d*u+v*f,t[3]=m*r+_*a+p*c,t[4]=m*i+_*s+p*h,t[5]=m*o+_*u+p*f,t[6]=g*r+M*a+b*c,t[7]=g*i+M*s+b*h,t[8]=g*o+M*u+b*f,t}function Lt(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=e[0],d=e[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l*r+d*a+c,t[7]=l*i+d*s+h,t[8]=l*o+d*u+f,t}function Pt(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=Math.sin(e),d=Math.cos(e);return t[0]=d*r+l*a,t[1]=d*i+l*s,t[2]=d*o+l*u,t[3]=d*a-l*r,t[4]=d*s-l*i,t[5]=d*u-l*o,t[6]=c,t[7]=h,t[8]=f,t}function St(t,n,e){var r=e[0],i=e[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Ot(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Dt(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=-e,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ut(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function It(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Bt(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,s=r+r,u=i+i,c=e*a,h=r*a,f=r*s,l=i*a,d=i*s,v=i*u,m=o*a,_=o*s,p=o*u;return t[0]=1-f-v,t[3]=h-p,t[6]=l+_,t[1]=h+p,t[4]=1-c-v,t[7]=d-m,t[2]=l-_,t[5]=d+m,t[8]=1-c-f,t}function Vt(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],v=n[12],m=n[13],_=n[14],p=n[15],g=e*s-r*a,M=e*u-i*a,b=e*c-o*a,x=r*u-i*s,A=r*c-o*s,w=i*c-o*u,y=h*m-f*v,E=h*_-l*v,R=h*p-d*v,T=f*_-l*m,F=f*p-d*m,L=l*p-d*_,P=g*L-M*F+b*T+x*R-A*E+w*y;return P?(P=1/P,t[0]=(s*L-u*F+c*T)*P,t[1]=(u*R-a*L-c*E)*P,t[2]=(a*F-s*R+c*y)*P,t[3]=(i*F-r*L-o*T)*P,t[4]=(e*L-i*R+o*E)*P,t[5]=(r*R-e*F-o*y)*P,t[6]=(m*w-_*A+p*x)*P,t[7]=(_*b-v*w-p*M)*P,t[8]=(v*A-m*b+p*g)*P,t):null}function Ct(t,n,e){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/e,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function qt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function zt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function jt(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t}function kt(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t}function Nt(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t}function Yt(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t}function Gt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function Ht(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=n[0],l=n[1],v=n[2],m=n[3],_=n[4],p=n[5],g=n[6],M=n[7],b=n[8];return Math.abs(e-f)<=d*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(r-l)<=d*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-v)<=d*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(o-m)<=d*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-_)<=d*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-g)<=d*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-M)<=d*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-b)<=d*Math.max(1,Math.abs(h),Math.abs(b))}var Xt=Ft,Kt=kt;function Wt(){var t=new v(16);return v!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function $t(t){var n=new v(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Qt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function Zt(t,n,e,r,i,o,a,s,u,c,h,f,l,d,m,_){var p=new v(16);return p[0]=t,p[1]=n,p[2]=e,p[3]=r,p[4]=i,p[5]=o,p[6]=a,p[7]=s,p[8]=u,p[9]=c,p[10]=h,p[11]=f,p[12]=l,p[13]=d,p[14]=m,p[15]=_,p}function Jt(t,n,e,r,i,o,a,s,u,c,h,f,l,d,v,m,_){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=l,t[12]=d,t[13]=v,t[14]=m,t[15]=_,t}function tn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nn(t,n){if(t===n){var e=n[1],r=n[2],i=n[3],o=n[6],a=n[7],s=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=e,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=o,t[11]=n[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function en(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],v=n[12],m=n[13],_=n[14],p=n[15],g=e*s-r*a,M=e*u-i*a,b=e*c-o*a,x=r*u-i*s,A=r*c-o*s,w=i*c-o*u,y=h*m-f*v,E=h*_-l*v,R=h*p-d*v,T=f*_-l*m,F=f*p-d*m,L=l*p-d*_,P=g*L-M*F+b*T+x*R-A*E+w*y;return P?(P=1/P,t[0]=(s*L-u*F+c*T)*P,t[1]=(i*F-r*L-o*T)*P,t[2]=(m*w-_*A+p*x)*P,t[3]=(l*A-f*w-d*x)*P,t[4]=(u*R-a*L-c*E)*P,t[5]=(e*L-i*R+o*E)*P,t[6]=(_*b-v*w-p*M)*P,t[7]=(h*w-l*b+d*M)*P,t[8]=(a*F-s*R+c*y)*P,t[9]=(r*R-e*F-o*y)*P,t[10]=(v*A-m*b+p*g)*P,t[11]=(f*b-h*A-d*g)*P,t[12]=(s*E-a*T-u*y)*P,t[13]=(e*T-r*E+i*y)*P,t[14]=(m*M-v*x-_*g)*P,t[15]=(h*x-f*M+l*g)*P,t):null}function rn(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=n[4],s=n[5],u=n[6],c=n[7],h=n[8],f=n[9],l=n[10],d=n[11],v=n[12],m=n[13],_=n[14],p=n[15];return t[0]=s*(l*p-d*_)-f*(u*p-c*_)+m*(u*d-c*l),t[1]=-(r*(l*p-d*_)-f*(i*p-o*_)+m*(i*d-o*l)),t[2]=r*(u*p-c*_)-s*(i*p-o*_)+m*(i*c-o*u),t[3]=-(r*(u*d-c*l)-s*(i*d-o*l)+f*(i*c-o*u)),t[4]=-(a*(l*p-d*_)-h*(u*p-c*_)+v*(u*d-c*l)),t[5]=e*(l*p-d*_)-h*(i*p-o*_)+v*(i*d-o*l),t[6]=-(e*(u*p-c*_)-a*(i*p-o*_)+v*(i*c-o*u)),t[7]=e*(u*d-c*l)-a*(i*d-o*l)+h*(i*c-o*u),t[8]=a*(f*p-d*m)-h*(s*p-c*m)+v*(s*d-c*f),t[9]=-(e*(f*p-d*m)-h*(r*p-o*m)+v*(r*d-o*f)),t[10]=e*(s*p-c*m)-a*(r*p-o*m)+v*(r*c-o*s),t[11]=-(e*(s*d-c*f)-a*(r*d-o*f)+h*(r*c-o*s)),t[12]=-(a*(f*_-l*m)-h*(s*_-u*m)+v*(s*l-u*f)),t[13]=e*(f*_-l*m)-h*(r*_-i*m)+v*(r*l-i*f),t[14]=-(e*(s*_-u*m)-a*(r*_-i*m)+v*(r*u-i*s)),t[15]=e*(s*l-u*f)-a*(r*l-i*f)+h*(r*u-i*s),t}function on(t){var n=t[0],e=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],f=t[10],l=t[11],d=t[12],v=t[13],m=t[14],_=t[15];return(n*a-e*o)*(f*_-l*m)-(n*s-r*o)*(h*_-l*v)+(n*u-i*o)*(h*m-f*v)+(e*s-r*a)*(c*_-l*d)-(e*u-i*a)*(c*m-f*d)+(r*u-i*s)*(c*v-h*d)}function an(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=n[8],l=n[9],d=n[10],v=n[11],m=n[12],_=n[13],p=n[14],g=n[15],M=e[0],b=e[1],x=e[2],A=e[3];return t[0]=M*r+b*s+x*f+A*m,t[1]=M*i+b*u+x*l+A*_,t[2]=M*o+b*c+x*d+A*p,t[3]=M*a+b*h+x*v+A*g,M=e[4],b=e[5],x=e[6],A=e[7],t[4]=M*r+b*s+x*f+A*m,t[5]=M*i+b*u+x*l+A*_,t[6]=M*o+b*c+x*d+A*p,t[7]=M*a+b*h+x*v+A*g,M=e[8],b=e[9],x=e[10],A=e[11],t[8]=M*r+b*s+x*f+A*m,t[9]=M*i+b*u+x*l+A*_,t[10]=M*o+b*c+x*d+A*p,t[11]=M*a+b*h+x*v+A*g,M=e[12],b=e[13],x=e[14],A=e[15],t[12]=M*r+b*s+x*f+A*m,t[13]=M*i+b*u+x*l+A*_,t[14]=M*o+b*c+x*d+A*p,t[15]=M*a+b*h+x*v+A*g,t}function sn(t,n,e){var r=e[0],i=e[1],o=e[2],a=void 0,s=void 0,u=void 0,c=void 0,h=void 0,f=void 0,l=void 0,d=void 0,v=void 0,m=void 0,_=void 0,p=void 0;return n===t?(t[12]=n[0]*r+n[4]*i+n[8]*o+n[12],t[13]=n[1]*r+n[5]*i+n[9]*o+n[13],t[14]=n[2]*r+n[6]*i+n[10]*o+n[14],t[15]=n[3]*r+n[7]*i+n[11]*o+n[15]):(a=n[0],s=n[1],u=n[2],c=n[3],h=n[4],f=n[5],l=n[6],d=n[7],v=n[8],m=n[9],_=n[10],p=n[11],t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=h,t[5]=f,t[6]=l,t[7]=d,t[8]=v,t[9]=m,t[10]=_,t[11]=p,t[12]=a*r+h*i+v*o+n[12],t[13]=s*r+f*i+m*o+n[13],t[14]=u*r+l*i+_*o+n[14],t[15]=c*r+d*i+p*o+n[15]),t}function un(t,n,e){var r=e[0],i=e[1],o=e[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function cn(t,n,e,r){var i,o,a,s,u,c,h,f,l,v,m,_,p,g,M,b,x,A,w,y,E,R,T,F,L=r[0],P=r[1],S=r[2],O=Math.sqrt(L*L+P*P+S*S);return O<d?null:(L*=O=1/O,P*=O,S*=O,i=Math.sin(e),a=1-(o=Math.cos(e)),s=n[0],u=n[1],c=n[2],h=n[3],f=n[4],l=n[5],v=n[6],m=n[7],_=n[8],p=n[9],g=n[10],M=n[11],b=L*L*a+o,x=P*L*a+S*i,A=S*L*a-P*i,w=L*P*a-S*i,y=P*P*a+o,E=S*P*a+L*i,R=L*S*a+P*i,T=P*S*a-L*i,F=S*S*a+o,t[0]=s*b+f*x+_*A,t[1]=u*b+l*x+p*A,t[2]=c*b+v*x+g*A,t[3]=h*b+m*x+M*A,t[4]=s*w+f*y+_*E,t[5]=u*w+l*y+p*E,t[6]=c*w+v*y+g*E,t[7]=h*w+m*y+M*E,t[8]=s*R+f*T+_*F,t[9]=u*R+l*T+p*F,t[10]=c*R+v*T+g*F,t[11]=h*R+m*T+M*F,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function hn(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[4],a=n[5],s=n[6],u=n[7],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*i+c*r,t[5]=a*i+h*r,t[6]=s*i+f*r,t[7]=u*i+l*r,t[8]=c*i-o*r,t[9]=h*i-a*r,t[10]=f*i-s*r,t[11]=l*i-u*r,t}function fn(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],s=n[2],u=n[3],c=n[8],h=n[9],f=n[10],l=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i-c*r,t[1]=a*i-h*r,t[2]=s*i-f*r,t[3]=u*i-l*r,t[8]=o*r+c*i,t[9]=a*r+h*i,t[10]=s*r+f*i,t[11]=u*r+l*i,t}function ln(t,n,e){var r=Math.sin(e),i=Math.cos(e),o=n[0],a=n[1],s=n[2],u=n[3],c=n[4],h=n[5],f=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i+c*r,t[1]=a*i+h*r,t[2]=s*i+f*r,t[3]=u*i+l*r,t[4]=c*i-o*r,t[5]=h*i-a*r,t[6]=f*i-s*r,t[7]=l*i-u*r,t}function dn(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function vn(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mn(t,n,e){var r,i,o,a=e[0],s=e[1],u=e[2],c=Math.sqrt(a*a+s*s+u*u);return c<d?null:(a*=c=1/c,s*=c,u*=c,r=Math.sin(n),o=1-(i=Math.cos(n)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function _n(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pn(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function gn(t,n){var e=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mn(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=r+r,u=i+i,c=o+o,h=r*s,f=r*u,l=r*c,d=i*u,v=i*c,m=o*c,_=a*s,p=a*u,g=a*c;return t[0]=1-(d+m),t[1]=f+g,t[2]=l-p,t[3]=0,t[4]=f-g,t[5]=1-(h+m),t[6]=v+_,t[7]=0,t[8]=l+p,t[9]=v-_,t[10]=1-(h+d),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function bn(t,n){var e=new v(3),r=-n[0],i=-n[1],o=-n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=r*r+i*i+o*o+a*a;return f>0?(e[0]=2*(s*a+h*r+u*o-c*i)/f,e[1]=2*(u*a+h*i+c*r-s*o)/f,e[2]=2*(c*a+h*o+s*i-u*r)/f):(e[0]=2*(s*a+h*r+u*o-c*i),e[1]=2*(u*a+h*i+c*r-s*o),e[2]=2*(c*a+h*o+s*i-u*r)),Mn(t,n,e),t}function xn(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function An(t,n){var e=n[0],r=n[1],i=n[2],o=n[4],a=n[5],s=n[6],u=n[8],c=n[9],h=n[10];return t[0]=Math.sqrt(e*e+r*r+i*i),t[1]=Math.sqrt(o*o+a*a+s*s),t[2]=Math.sqrt(u*u+c*c+h*h),t}function wn(t,n){var e=n[0]+n[5]+n[10],r=0;return e>0?(r=2*Math.sqrt(e+1),t[3]=.25*r,t[0]=(n[6]-n[9])/r,t[1]=(n[8]-n[2])/r,t[2]=(n[1]-n[4])/r):n[0]>n[5]&&n[0]>n[10]?(r=2*Math.sqrt(1+n[0]-n[5]-n[10]),t[3]=(n[6]-n[9])/r,t[0]=.25*r,t[1]=(n[1]+n[4])/r,t[2]=(n[8]+n[2])/r):n[5]>n[10]?(r=2*Math.sqrt(1+n[5]-n[0]-n[10]),t[3]=(n[8]-n[2])/r,t[0]=(n[1]+n[4])/r,t[1]=.25*r,t[2]=(n[6]+n[9])/r):(r=2*Math.sqrt(1+n[10]-n[0]-n[5]),t[3]=(n[1]-n[4])/r,t[0]=(n[8]+n[2])/r,t[1]=(n[6]+n[9])/r,t[2]=.25*r),t}function yn(t,n,e,r){var i=n[0],o=n[1],a=n[2],s=n[3],u=i+i,c=o+o,h=a+a,f=i*u,l=i*c,d=i*h,v=o*c,m=o*h,_=a*h,p=s*u,g=s*c,M=s*h,b=r[0],x=r[1],A=r[2];return t[0]=(1-(v+_))*b,t[1]=(l+M)*b,t[2]=(d-g)*b,t[3]=0,t[4]=(l-M)*x,t[5]=(1-(f+_))*x,t[6]=(m+p)*x,t[7]=0,t[8]=(d+g)*A,t[9]=(m-p)*A,t[10]=(1-(f+v))*A,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function En(t,n,e,r,i){var o=n[0],a=n[1],s=n[2],u=n[3],c=o+o,h=a+a,f=s+s,l=o*c,d=o*h,v=o*f,m=a*h,_=a*f,p=s*f,g=u*c,M=u*h,b=u*f,x=r[0],A=r[1],w=r[2],y=i[0],E=i[1],R=i[2],T=(1-(m+p))*x,F=(d+b)*x,L=(v-M)*x,P=(d-b)*A,S=(1-(l+p))*A,O=(_+g)*A,D=(v+M)*w,U=(_-g)*w,I=(1-(l+m))*w;return t[0]=T,t[1]=F,t[2]=L,t[3]=0,t[4]=P,t[5]=S,t[6]=O,t[7]=0,t[8]=D,t[9]=U,t[10]=I,t[11]=0,t[12]=e[0]+y-(T*y+P*E+D*R),t[13]=e[1]+E-(F*y+S*E+U*R),t[14]=e[2]+R-(L*y+O*E+I*R),t[15]=1,t}function Rn(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e+e,s=r+r,u=i+i,c=e*a,h=r*a,f=r*s,l=i*a,d=i*s,v=i*u,m=o*a,_=o*s,p=o*u;return t[0]=1-f-v,t[1]=h+p,t[2]=l-_,t[3]=0,t[4]=h-p,t[5]=1-c-v,t[6]=d+m,t[7]=0,t[8]=l+_,t[9]=d-m,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tn(t,n,e,r,i,o,a){var s=1/(e-n),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(e+n)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function Fn(t,n,e,r,i){var o=1/Math.tan(n/2),a=void 0;return t[0]=o/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(r-i),t[10]=(i+r)*a,t[14]=2*i*r*a):(t[10]=-1,t[14]=-2*r),t}function Ln(t,n,e,r){var i=Math.tan(n.upDegrees*Math.PI/180),o=Math.tan(n.downDegrees*Math.PI/180),a=Math.tan(n.leftDegrees*Math.PI/180),s=Math.tan(n.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(e-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*e/(e-r),t[15]=0,t}function Pn(t,n,e,r,i,o,a){var s=1/(n-e),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+e)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}function Sn(t,n,e,r){var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,c=void 0,h=void 0,f=void 0,l=void 0,v=void 0,m=n[0],_=n[1],p=n[2],g=r[0],M=r[1],b=r[2],x=e[0],A=e[1],w=e[2];return Math.abs(m-x)<d&&Math.abs(_-A)<d&&Math.abs(p-w)<d?tn(t):(h=m-x,f=_-A,l=p-w,i=M*(l*=v=1/Math.sqrt(h*h+f*f+l*l))-b*(f*=v),o=b*(h*=v)-g*l,a=g*f-M*h,(v=Math.sqrt(i*i+o*o+a*a))?(i*=v=1/v,o*=v,a*=v):(i=0,o=0,a=0),s=f*a-l*o,u=l*i-h*a,c=h*o-f*i,(v=Math.sqrt(s*s+u*u+c*c))?(s*=v=1/v,u*=v,c*=v):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=c,t[10]=l,t[11]=0,t[12]=-(i*m+o*_+a*p),t[13]=-(s*m+u*_+c*p),t[14]=-(h*m+f*_+l*p),t[15]=1,t)}function On(t,n,e,r){var i=n[0],o=n[1],a=n[2],s=r[0],u=r[1],c=r[2],h=i-e[0],f=o-e[1],l=a-e[2],d=h*h+f*f+l*l;d>0&&(h*=d=1/Math.sqrt(d),f*=d,l*=d);var v=u*l-c*f,m=c*h-s*l,_=s*f-u*h;return(d=v*v+m*m+_*_)>0&&(v*=d=1/Math.sqrt(d),m*=d,_*=d),t[0]=v,t[1]=m,t[2]=_,t[3]=0,t[4]=f*_-l*m,t[5]=l*v-h*_,t[6]=h*m-f*v,t[7]=0,t[8]=h,t[9]=f,t[10]=l,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Dn(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Un(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function In(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t[8]=n[8]+e[8],t[9]=n[9]+e[9],t[10]=n[10]+e[10],t[11]=n[11]+e[11],t[12]=n[12]+e[12],t[13]=n[13]+e[13],t[14]=n[14]+e[14],t[15]=n[15]+e[15],t}function Bn(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t[4]=n[4]-e[4],t[5]=n[5]-e[5],t[6]=n[6]-e[6],t[7]=n[7]-e[7],t[8]=n[8]-e[8],t[9]=n[9]-e[9],t[10]=n[10]-e[10],t[11]=n[11]-e[11],t[12]=n[12]-e[12],t[13]=n[13]-e[13],t[14]=n[14]-e[14],t[15]=n[15]-e[15],t}function Vn(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=n[11]*e,t[12]=n[12]*e,t[13]=n[13]*e,t[14]=n[14]*e,t[15]=n[15]*e,t}function Cn(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t[4]=n[4]+e[4]*r,t[5]=n[5]+e[5]*r,t[6]=n[6]+e[6]*r,t[7]=n[7]+e[7]*r,t[8]=n[8]+e[8]*r,t[9]=n[9]+e[9]*r,t[10]=n[10]+e[10]*r,t[11]=n[11]+e[11]*r,t[12]=n[12]+e[12]*r,t[13]=n[13]+e[13]*r,t[14]=n[14]+e[14]*r,t[15]=n[15]+e[15]*r,t}function qn(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function zn(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],f=t[9],l=t[10],v=t[11],m=t[12],_=t[13],p=t[14],g=t[15],M=n[0],b=n[1],x=n[2],A=n[3],w=n[4],y=n[5],E=n[6],R=n[7],T=n[8],F=n[9],L=n[10],P=n[11],S=n[12],O=n[13],D=n[14],U=n[15];return Math.abs(e-M)<=d*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(r-b)<=d*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-x)<=d*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-A)<=d*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-w)<=d*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-y)<=d*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-E)<=d*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-R)<=d*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-T)<=d*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-F)<=d*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(l-L)<=d*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(v-P)<=d*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(m-S)<=d*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(_-O)<=d*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(p-D)<=d*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-U)<=d*Math.max(1,Math.abs(g),Math.abs(U))}var jn=an,kn=Bn;function Nn(){var t=new v(3);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Yn(t){var n=new v(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function Gn(t){var n=t[0],e=t[1],r=t[2];return Math.sqrt(n*n+e*e+r*r)}function Hn(t,n,e){var r=new v(3);return r[0]=t,r[1]=n,r[2]=e,r}function Xn(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Kn(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function Wn(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function $n(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t}function Qn(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t}function Zn(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t}function Jn(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function te(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function ne(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t}function ee(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t}function re(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function ie(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function oe(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t}function ae(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(e*e+r*r+i*i)}function se(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2];return e*e+r*r+i*i}function ue(t){var n=t[0],e=t[1],r=t[2];return n*n+e*e+r*r}function ce(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function he(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function fe(t,n){var e=n[0],r=n[1],i=n[2],o=e*e+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o),t}function le(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function de(t,n,e){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1],u=e[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function ve(t,n,e,r){var i=n[0],o=n[1],a=n[2];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t[2]=a+r*(e[2]-a),t}function me(t,n,e,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),h=a*(3-2*o);return t[0]=n[0]*s+e[0]*u+r[0]*c+i[0]*h,t[1]=n[1]*s+e[1]*u+r[1]*c+i[1]*h,t[2]=n[2]*s+e[2]*u+r[2]*c+i[2]*h,t}function _e(t,n,e,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,h=3*o*s,f=3*u*a,l=u*o;return t[0]=n[0]*c+e[0]*h+r[0]*f+i[0]*l,t[1]=n[1]*c+e[1]*h+r[1]*f+i[1]*l,t[2]=n[2]*c+e[2]*h+r[2]*f+i[2]*l,t}function pe(t,n){n=n||1;var e=2*m()*Math.PI,r=2*m()-1,i=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=r*n,t}function ge(t,n,e){var r=n[0],i=n[1],o=n[2],a=e[3]*r+e[7]*i+e[11]*o+e[15];return a=a||1,t[0]=(e[0]*r+e[4]*i+e[8]*o+e[12])/a,t[1]=(e[1]*r+e[5]*i+e[9]*o+e[13])/a,t[2]=(e[2]*r+e[6]*i+e[10]*o+e[14])/a,t}function Me(t,n,e){var r=n[0],i=n[1],o=n[2];return t[0]=r*e[0]+i*e[3]+o*e[6],t[1]=r*e[1]+i*e[4]+o*e[7],t[2]=r*e[2]+i*e[5]+o*e[8],t}function be(t,n,e){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=i*c-o*u,f=o*s-r*c,l=r*u-i*s,d=i*l-o*f,v=o*h-r*l,m=r*f-i*h,_=2*a;return h*=_,f*=_,l*=_,d*=2,v*=2,m*=2,t[0]=s+h+d,t[1]=u+f+v,t[2]=c+l+m,t}function xe(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function Ae(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function we(t,n,e,r){var i=[],o=[];return i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2],t}function ye(t,n){var e=Hn(t[0],t[1],t[2]),r=Hn(n[0],n[1],n[2]);fe(e,e),fe(r,r);var i=le(e,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Ee(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Re(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Te(t,n){var e=t[0],r=t[1],i=t[2],o=n[0],a=n[1],s=n[2];return Math.abs(e-o)<=d*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=d*Math.max(1,Math.abs(i),Math.abs(s))}var Fe=$n,Le=Qn,Pe=Zn,Se=ae,Oe=se,De=Gn,Ue=ue,Ie=function(){var t=Nn();return function(n,e,r,i,o,a){var s=void 0,u=void 0;for(e||(e=3),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;s<u;s+=e)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],o(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2];return n}}();function Be(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ve(t){var n=new v(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Ce(t,n,e,r){var i=new v(4);return i[0]=t,i[1]=n,i[2]=e,i[3]=r,i}function qe(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function ze(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function je(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t}function ke(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t[3]=n[3]-e[3],t}function Ne(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t[2]=n[2]*e[2],t[3]=n[3]*e[3],t}function Ye(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function Ge(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function He(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function Xe(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t[2]=Math.min(n[2],e[2]),t[3]=Math.min(n[3],e[3]),t}function Ke(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t[2]=Math.max(n[2],e[2]),t[3]=Math.max(n[3],e[3]),t}function We(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function $e(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function Qe(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t[2]=n[2]+e[2]*r,t[3]=n[3]+e[3]*r,t}function Ze(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return Math.sqrt(e*e+r*r+i*i+o*o)}function Je(t,n){var e=n[0]-t[0],r=n[1]-t[1],i=n[2]-t[2],o=n[3]-t[3];return e*e+r*r+i*i+o*o}function tr(t){var n=t[0],e=t[1],r=t[2],i=t[3];return Math.sqrt(n*n+e*e+r*r+i*i)}function nr(t){var n=t[0],e=t[1],r=t[2],i=t[3];return n*n+e*e+r*r+i*i}function er(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function rr(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function ir(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e*e+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=e*a,t[1]=r*a,t[2]=i*a,t[3]=o*a),t}function or(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function ar(t,n,e,r){var i=n[0],o=n[1],a=n[2],s=n[3];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t[2]=a+r*(e[2]-a),t[3]=s+r*(e[3]-s),t}function sr(t,n){var e,r,i,o,a,s;n=n||1;do{a=(e=2*m()-1)*e+(r=2*m()-1)*r}while(a>=1);do{s=(i=2*m()-1)*i+(o=2*m()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=n*e,t[1]=n*r,t[2]=n*i*u,t[3]=n*o*u,t}function ur(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3];return t[0]=e[0]*r+e[4]*i+e[8]*o+e[12]*a,t[1]=e[1]*r+e[5]*i+e[9]*o+e[13]*a,t[2]=e[2]*r+e[6]*i+e[10]*o+e[14]*a,t[3]=e[3]*r+e[7]*i+e[11]*o+e[15]*a,t}function cr(t,n,e){var r=n[0],i=n[1],o=n[2],a=e[0],s=e[1],u=e[2],c=e[3],h=c*r+s*o-u*i,f=c*i+u*r-a*o,l=c*o+a*i-s*r,d=-a*r-s*i-u*o;return t[0]=h*c+d*-a+f*-u-l*-s,t[1]=f*c+d*-s+l*-a-h*-u,t[2]=l*c+d*-u+h*-s-f*-a,t[3]=n[3],t}function hr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fr(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function lr(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=n[0],s=n[1],u=n[2],c=n[3];return Math.abs(e-a)<=d*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=d*Math.max(1,Math.abs(o),Math.abs(c))}var dr=ke,vr=Ne,mr=Ye,_r=Ze,pr=Je,gr=tr,Mr=nr,br=function(){var t=Be();return function(n,e,r,i,o,a){var s=void 0,u=void 0;for(e||(e=4),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;s<u;s+=e)t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],t[3]=n[s+3],o(t,t,a),n[s]=t[0],n[s+1]=t[1],n[s+2]=t[2],n[s+3]=t[3];return n}}();function xr(){var t=new v(4);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ar(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function wr(t,n,e){e*=.5;var r=Math.sin(e);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(e),t}function yr(t,n){var e=2*Math.acos(n[3]),r=Math.sin(e/2);return r>d?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),e}function Er(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,t}function Rr(t,n,e){e*=.5;var r=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t}function Tr(t,n,e){e*=.5;var r=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t}function Fr(t,n,e){e*=.5;var r=n[0],i=n[1],o=n[2],a=n[3],s=Math.sin(e),u=Math.cos(e);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t}function Lr(t,n){var e=n[0],r=n[1],i=n[2];return t[0]=e,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-e*e-r*r-i*i)),t}function Pr(t,n,e,r){var i=n[0],o=n[1],a=n[2],s=n[3],u=e[0],c=e[1],h=e[2],f=e[3],l=void 0,v=void 0,m=void 0,_=void 0,p=void 0;return(v=i*u+o*c+a*h+s*f)<0&&(v=-v,u=-u,c=-c,h=-h,f=-f),1-v>d?(l=Math.acos(v),m=Math.sin(l),_=Math.sin((1-r)*l)/m,p=Math.sin(r*l)/m):(_=1-r,p=r),t[0]=_*i+p*u,t[1]=_*o+p*c,t[2]=_*a+p*h,t[3]=_*s+p*f,t}function Sr(t){var n=m(),e=m(),r=m(),i=Math.sqrt(1-n),o=Math.sqrt(n);return t[0]=i*Math.sin(2*Math.PI*e),t[1]=i*Math.cos(2*Math.PI*e),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Or(t,n){var e=n[0],r=n[1],i=n[2],o=n[3],a=e*e+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-e*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t}function Dr(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function Ur(t,n){var e=n[0]+n[4]+n[8],r=void 0;if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r;else{var i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(n[3*i+i]-n[3*o+o]-n[3*a+a]+1),t[i]=.5*r,r=.5/r,t[3]=(n[3*o+a]-n[3*a+o])*r,t[o]=(n[3*o+i]+n[3*i+o])*r,t[a]=(n[3*a+i]+n[3*i+a])*r}return t}function Ir(t,n,e,r){var i=.5*Math.PI/180;n*=i,e*=i,r*=i;var o=Math.sin(n),a=Math.cos(n),s=Math.sin(e),u=Math.cos(e),c=Math.sin(r),h=Math.cos(r);return t[0]=o*u*h-a*s*c,t[1]=a*s*h+o*u*c,t[2]=a*u*c-o*s*h,t[3]=a*u*h+o*s*c,t}function Br(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Vr=Ve,Cr=Ce,qr=qe,zr=ze,jr=je,kr=Er,Nr=$e,Yr=or,Gr=ar,Hr=tr,Xr=Hr,Kr=nr,Wr=Kr,$r=ir,Qr=fr,Zr=lr,Jr=function(){var t=Nn(),n=Hn(1,0,0),e=Hn(0,1,0);return function(r,i,o){var a=le(i,o);return a<-.999999?(de(t,n,i),De(t)<1e-6&&de(t,e,i),fe(t,t),wr(r,t,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(de(t,i,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+a,$r(r,r))}}(),ti=function(){var t=xr(),n=xr();return function(e,r,i,o,a,s){return Pr(t,r,a,s),Pr(n,i,o,s),Pr(e,t,n,2*s*(1-s)),e}}(),ni=function(){var t=pt();return function(n,e,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-e[0],t[5]=-e[1],t[8]=-e[2],$r(n,Ur(n,t))}}();function ei(){var t=new v(8);return v!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ri(t){var n=new v(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function ii(t,n,e,r,i,o,a,s){var u=new v(8);return u[0]=t,u[1]=n,u[2]=e,u[3]=r,u[4]=i,u[5]=o,u[6]=a,u[7]=s,u}function oi(t,n,e,r,i,o,a){var s=new v(8);s[0]=t,s[1]=n,s[2]=e,s[3]=r;var u=.5*i,c=.5*o,h=.5*a;return s[4]=u*r+c*e-h*n,s[5]=c*r+h*t-u*e,s[6]=h*r+u*n-c*t,s[7]=-u*t-c*n-h*e,s}function ai(t,n,e){var r=.5*e[0],i=.5*e[1],o=.5*e[2],a=n[0],s=n[1],u=n[2],c=n[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=c,t[4]=r*c+i*u-o*s,t[5]=i*c+o*a-r*u,t[6]=o*c+r*s-i*a,t[7]=-r*a-i*s-o*u,t}function si(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*n[0],t[5]=.5*n[1],t[6]=.5*n[2],t[7]=0,t}function ui(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function ci(t,n){var e=xr();wn(e,n);var r=new v(3);return xn(r,n),ai(t,e,r),t}function hi(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}function fi(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function li(t,n,e,r,i,o,a,s,u){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t}var di=qr;function vi(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t}var mi=qr;function _i(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t}function pi(t,n){var e=n[4],r=n[5],i=n[6],o=n[7],a=-n[0],s=-n[1],u=-n[2],c=n[3];return t[0]=2*(e*c+o*a+r*u-i*s),t[1]=2*(r*c+o*s+i*a-e*u),t[2]=2*(i*c+o*u+e*s-r*a),t}function gi(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=.5*e[0],u=.5*e[1],c=.5*e[2],h=n[4],f=n[5],l=n[6],d=n[7];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*c-o*u+h,t[5]=a*u+o*s-r*c+f,t[6]=a*c+r*u-i*s+l,t[7]=-r*s-i*u-o*c+d,t}function Mi(t,n,e){var r=-n[0],i=-n[1],o=-n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,d=c*a+h*o+s*i-u*r,v=h*a-s*r-u*i-c*o;return Rr(t,n,e),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+v*r+l*o-d*i,t[5]=l*a+v*i+d*r-f*o,t[6]=d*a+v*o+f*i-l*r,t[7]=v*a-f*r-l*i-d*o,t}function bi(t,n,e){var r=-n[0],i=-n[1],o=-n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,d=c*a+h*o+s*i-u*r,v=h*a-s*r-u*i-c*o;return Tr(t,n,e),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+v*r+l*o-d*i,t[5]=l*a+v*i+d*r-f*o,t[6]=d*a+v*o+f*i-l*r,t[7]=v*a-f*r-l*i-d*o,t}function xi(t,n,e){var r=-n[0],i=-n[1],o=-n[2],a=n[3],s=n[4],u=n[5],c=n[6],h=n[7],f=s*a+h*r+u*o-c*i,l=u*a+h*i+c*r-s*o,d=c*a+h*o+s*i-u*r,v=h*a-s*r-u*i-c*o;return Fr(t,n,e),r=t[0],i=t[1],o=t[2],a=t[3],t[4]=f*a+v*r+l*o-d*i,t[5]=l*a+v*i+d*r-f*o,t[6]=d*a+v*o+f*i-l*r,t[7]=v*a-f*r-l*i-d*o,t}function Ai(t,n,e){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],c=n[2],h=n[3];return t[0]=s*a+h*r+u*o-c*i,t[1]=u*a+h*i+c*r-s*o,t[2]=c*a+h*o+s*i-u*r,t[3]=h*a-s*r-u*i-c*o,s=n[4],u=n[5],c=n[6],h=n[7],t[4]=s*a+h*r+u*o-c*i,t[5]=u*a+h*i+c*r-s*o,t[6]=c*a+h*o+s*i-u*r,t[7]=h*a-s*r-u*i-c*o,t}function wi(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],h=e[3];return t[0]=r*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-r*c,t[2]=o*h+a*c+r*u-i*s,t[3]=a*h-r*s-i*u-o*c,s=e[4],u=e[5],c=e[6],h=e[7],t[4]=r*h+a*s+i*c-o*u,t[5]=i*h+a*u+o*s-r*c,t[6]=o*h+a*c+r*u-i*s,t[7]=a*h-r*s-i*u-o*c,t}function yi(t,n,e,r){if(Math.abs(r)<d)return hi(t,n);var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);r*=.5;var o=Math.sin(r),a=o*e[0]/i,s=o*e[1]/i,u=o*e[2]/i,c=Math.cos(r),h=n[0],f=n[1],l=n[2],v=n[3];t[0]=h*c+v*a+f*u-l*s,t[1]=f*c+v*s+l*a-h*u,t[2]=l*c+v*u+h*s-f*a,t[3]=v*c-h*a-f*s-l*u;var m=n[4],_=n[5],p=n[6],g=n[7];return t[4]=m*c+g*a+_*u-p*s,t[5]=_*c+g*s+p*a-m*u,t[6]=p*c+g*u+m*s-_*a,t[7]=g*c-m*a-_*s-p*u,t}function Ei(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t[3]=n[3]+e[3],t[4]=n[4]+e[4],t[5]=n[5]+e[5],t[6]=n[6]+e[6],t[7]=n[7]+e[7],t}function Ri(t,n,e){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[4],u=e[5],c=e[6],h=e[7],f=n[4],l=n[5],d=n[6],v=n[7],m=e[0],_=e[1],p=e[2],g=e[3];return t[0]=r*g+a*m+i*p-o*_,t[1]=i*g+a*_+o*m-r*p,t[2]=o*g+a*p+r*_-i*m,t[3]=a*g-r*m-i*_-o*p,t[4]=r*h+a*s+i*c-o*u+f*g+v*m+l*p-d*_,t[5]=i*h+a*u+o*s-r*c+l*g+v*_+d*m-f*p,t[6]=o*h+a*c+r*u-i*s+d*g+v*p+f*_-l*m,t[7]=a*h-r*s-i*u-o*c+v*g-f*m-l*_-d*p,t}var Ti=Ri;function Fi(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*e,t[5]=n[5]*e,t[6]=n[6]*e,t[7]=n[7]*e,t}var Li=Yr;function Pi(t,n,e,r){var i=1-r;return Li(n,e)<0&&(r=-r),t[0]=n[0]*i+e[0]*r,t[1]=n[1]*i+e[1]*r,t[2]=n[2]*i+e[2]*r,t[3]=n[3]*i+e[3]*r,t[4]=n[4]*i+e[4]*r,t[5]=n[5]*i+e[5]*r,t[6]=n[6]*i+e[6]*r,t[7]=n[7]*i+e[7]*r,t}function Si(t,n){var e=Ii(n);return t[0]=-n[0]/e,t[1]=-n[1]/e,t[2]=-n[2]/e,t[3]=n[3]/e,t[4]=-n[4]/e,t[5]=-n[5]/e,t[6]=-n[6]/e,t[7]=n[7]/e,t}function Oi(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t}var Di=Hr,Ui=Di,Ii=Kr,Bi=Ii;function Vi(t,n){var e=Ii(n);if(e>0){e=Math.sqrt(e);var r=n[0]/e,i=n[1]/e,o=n[2]/e,a=n[3]/e,s=n[4],u=n[5],c=n[6],h=n[7],f=r*s+i*u+o*c+a*h;t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-r*f)/e,t[5]=(u-i*f)/e,t[6]=(c-o*f)/e,t[7]=(h-a*f)/e}return t}function Ci(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function qi(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]}function zi(t,n){var e=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=n[0],f=n[1],l=n[2],v=n[3],m=n[4],_=n[5],p=n[6],g=n[7];return Math.abs(e-h)<=d*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-l)<=d*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-v)<=d*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-m)<=d*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-_)<=d*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-p)<=d*Math.max(1,Math.abs(u),Math.abs(p))&&Math.abs(c-g)<=d*Math.max(1,Math.abs(c),Math.abs(g))}function ji(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function ki(t){var n=new v(2);return n[0]=t[0],n[1]=t[1],n}function Ni(t,n){var e=new v(2);return e[0]=t,e[1]=n,e}function Yi(t,n){return t[0]=n[0],t[1]=n[1],t}function Gi(t,n,e){return t[0]=n,t[1]=e,t}function Hi(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t}function Xi(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t}function Ki(t,n,e){return t[0]=n[0]*e[0],t[1]=n[1]*e[1],t}function Wi(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t}function $i(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function Qi(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function Zi(t,n,e){return t[0]=Math.min(n[0],e[0]),t[1]=Math.min(n[1],e[1]),t}function Ji(t,n,e){return t[0]=Math.max(n[0],e[0]),t[1]=Math.max(n[1],e[1]),t}function to(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function no(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t}function eo(t,n,e,r){return t[0]=n[0]+e[0]*r,t[1]=n[1]+e[1]*r,t}function ro(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.sqrt(e*e+r*r)}function io(t,n){var e=n[0]-t[0],r=n[1]-t[1];return e*e+r*r}function oo(t){var n=t[0],e=t[1];return Math.sqrt(n*n+e*e)}function ao(t){var n=t[0],e=t[1];return n*n+e*e}function so(t,n){return t[0]=-n[0],t[1]=-n[1],t}function uo(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function co(t,n){var e=n[0],r=n[1],i=e*e+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=n[0]*i,t[1]=n[1]*i),t}function ho(t,n){return t[0]*n[0]+t[1]*n[1]}function fo(t,n,e){var r=n[0]*e[1]-n[1]*e[0];return t[0]=t[1]=0,t[2]=r,t}function lo(t,n,e,r){var i=n[0],o=n[1];return t[0]=i+r*(e[0]-i),t[1]=o+r*(e[1]-o),t}function vo(t,n){n=n||1;var e=2*m()*Math.PI;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t}function mo(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i,t[1]=e[1]*r+e[3]*i,t}function _o(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[2]*i+e[4],t[1]=e[1]*r+e[3]*i+e[5],t}function po(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[3]*i+e[6],t[1]=e[1]*r+e[4]*i+e[7],t}function go(t,n,e){var r=n[0],i=n[1];return t[0]=e[0]*r+e[4]*i+e[12],t[1]=e[1]*r+e[5]*i+e[13],t}function Mo(t,n,e,r){var i=n[0]-e[0],o=n[1]-e[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+e[0],t[1]=i*a+o*s+e[1],t}function bo(t,n){var e=t[0],r=t[1],i=n[0],o=n[1],a=e*e+r*r;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var u=(e*i+r*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)}function xo(t){return"vec2("+t[0]+", "+t[1]+")"}function Ao(t,n){return t[0]===n[0]&&t[1]===n[1]}function wo(t,n){var e=t[0],r=t[1],i=n[0],o=n[1];return Math.abs(e-i)<=d*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))}var yo=oo,Eo=Xi,Ro=Ki,To=Wi,Fo=ro,Lo=io,Po=ao,So=function(){var t=ji();return function(n,e,r,i,o,a){var s=void 0,u=void 0;for(e||(e=2),r||(r=0),u=i?Math.min(i*e+r,n.length):n.length,s=r;s<u;s+=e)t[0]=n[s],t[1]=n[s+1],o(t,t,a),n[s]=t[0],n[s+1]=t[1];return n}}();e.d(n,"glMatrix",function(){return r}),e.d(n,"mat2",function(){return i}),e.d(n,"mat2d",function(){return o}),e.d(n,"mat3",function(){return a}),e.d(n,"mat4",function(){return s}),e.d(n,"quat",function(){return h}),e.d(n,"quat2",function(){return f}),e.d(n,"vec2",function(){return l}),e.d(n,"vec3",function(){return u}),e.d(n,"vec4",function(){return c})},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0);function i(t){return r.vec3.fromValues(t,t,t)}function o(...t){return t.reduce((t,n)=>r.vec3.add(t,t,n),i(0))}function a(...t){return t.reduce((t,n)=>r.vec3.mul(t,t,n),i(1))}function s(t,n){return a(t,[n,n,n])}function u(t){return r.vec3.fromValues(t[0],t[1],t[2])}n.vec=function(t,n,e){return r.vec3.fromValues(t,n,e)},n.fill=i,n.sum=o,n.prod=a,n.div=function(t,n){const e=r.vec3.create();return r.vec3.div(e,t,n)},n.sub=function(t,n){const e=r.vec3.create();return r.vec3.sub(e,t,n)},n.times=s,n.scale=s,n.centroid=function(...t){return n.scale(o(...t),1/t.length)},n.normalize=function(t){const n=r.vec3.create();return r.vec3.normalize(n,t),n},n.vec3FromVec4=u,n.transform=function(t,n){const e=r.vec4.fromValues(t[0],t[1],t[2],0);return r.vec4.transformMat4(e,e,n),u(e)},n.rotate=function(t,n){const e=r.vec3.create();return r.vec3.transformQuat(e,t,n),r.vec3.normalize(e,e),e},n.cross=function(t,n){const e=r.vec3.create();return r.vec3.cross(e,t,n)},n.lerp=function(t,n,e){const i=r.vec3.create();return r.vec3.lerp(i,t,n,e)},n.collinear=function(t,n,e=1e-4){return Math.abs(Math.abs(r.vec3.dot(t,n)/(r.vec3.len(t)*r.vec3.len(n)))-1)<e}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0);n.degrees=(t=>57.29577951308232*t%360),n.radians=(t=>.017453292519943295*t%6.283185307179586),n.clamp=((t,n,e)=>Math.min(Math.max(t,n),e)),n.total=((...t)=>t.reduce((t,n)=>t+n,0)),n.average=((...t)=>0!==t.length?n.total(...t)/t.length:0),n.numFormat=function(t,n=10){if(!Number.isFinite(t))return null;if(`${t}`.length<n)return`${t}`;const e=t,r=n,i=t<0;let o;t=Math.abs(t),n-=i?1:0,n=Math.floor(n);const[a,s]=[`${Math.floor(t)}`,`${t%1}`.slice(2)],u=n-(a.length+1);if(a.length===n||n===a.length+1)o=a;else if(u>=0){const t=parseFloat(parseFloat("0."+s).toFixed(u));o=(o=`${parseFloat(a)+t}`).endsWith(".")?o.slice(0,-1):o}else{const i=t.toExponential(),s=i.substr(i.indexOf("e"));if(n<s.length+1){const t=n<=a.length?a:`${i.charAt(0)}${s}`;throw new Error(`Cannot represent '${e}' with less than ${t.length} characters, `+`minimal approximation is '${t}', got max_length = ${r}`)}const u=i.substr(0,i.length-s.length),c=n-(s.length+2);let h=-1!==c?parseFloat(u).toFixed(c):u;o=(h=(h=h.substr(0,n-s.length)).endsWith(".")?h.slice(0,-1):h).substr(0,n-s.length)+s}return`${i?"-":""}${o}`},n.combineMatrices=function(...t){const n=r.mat4.clone(t[0]);for(let e=1;e<t.length;e++)r.mat4.mul(n,n,t[e]);return n},n.invert=function(t){const n=r.mat4.create();return r.mat4.invert(n,t)},n.randomMat4=function(t=(()=>Math.random())){return new Float32Array(16).map(t)},n.triangleHypotenuse=function(t,n,e){return[{from:t,to:n,other:e,len:r.vec3.dist(t,n)},{from:t,to:e,other:n,len:r.vec3.dist(t,e)},{from:n,to:e,other:t,len:r.vec3.dist(n,e)}].sort((t,n)=>n.len-t.len)[0]},n.mapIntervals=((t,n,e,r,i)=>r+(t-n)*(i-r)/(e-n)),n.getAltitude=((t,e,i)=>n.clamp(r.vec3.dist(t,e)-i,0,1/0)),n.getNormalizedAltitude=((t,n,e)=>2/(1+Math.exp(-this.getAltitude(t,n,e)/e))-1)},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.VERTEX=0]="VERTEX",t[t.FRAGMENT=1]="FRAGMENT"}(n.ShaderType||(n.ShaderType={}));n.default=class{constructor(t,n){this.gl=t,this._vertex_shader=this.createShader(this.gl.VERTEX_SHADER,n.vertex),this._fragment_shader=this.createShader(this.gl.FRAGMENT_SHADER,n.fragment),this._program=this.createProgram(),this._texture_map=new Map}createShader(t,n){const e=this.gl.createShader(t);if(this.gl.shaderSource(e,n),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)){const t=this.gl.getShaderInfoLog(e);throw this.gl.deleteShader(e),new Error(t)}return e}createProgram(){const t=this.gl.createProgram();if(this.gl.attachShader(t,this._vertex_shader),this.gl.attachShader(t,this._fragment_shader),this.gl.linkProgram(t),!this.gl.getProgramParameter(t,this.gl.LINK_STATUS)){const n=this.gl.getProgramInfoLog(t);throw this.gl.deleteProgram(t),new Error(n)}return t}use(){this.gl.useProgram(this._program)}get program(){return this._program}getAttribLocation(t){return this.gl.getAttribLocation(this._program,t)}getUniformLocation(t){return this.gl.getUniformLocation(this._program,t)}attachTexture(t,n){this._texture_map.set(t,n)}bindTextures(){for(const[t,n]of this._texture_map)this.setInt(t,n)}setFloat(t,n){const e=this.getUniformLocation(t);return this.gl.uniform1f(e,n),e}setInt(t,n){const e=this.getUniformLocation(t);return this.gl.uniform1i(e,Math.floor(n)),e}setBool(t,n){return this.setInt(t,n?1:0)}setVec2(t,n){const e=this.getUniformLocation(t);return this.gl.uniform2fv(e,n),e}setVec3(t,n){const e=this.getUniformLocation(t);return this.gl.uniform3fv(e,n),e}setVec4(t,n){const e=this.getUniformLocation(t);return this.gl.uniform4fv(e,n),e}setMat4(t,n,e=!1){const r=this.getUniformLocation(t);return this.gl.uniformMatrix4fv(r,e,n),r}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(3),i=e(15),o=e(0),a=e(5),s=e(1);function u(t,n=a.colors.green){const e=new r.default(t,i.wireFrameShader);e.use();const o=e.getAttribLocation("position"),s=t.createVertexArray(),u=t.createBuffer();return t.bindVertexArray(s),t.bindBuffer(t.ARRAY_BUFFER,u),t.vertexAttribPointer(o,3,t.FLOAT,!1,12,0),t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null),(r,...i)=>{e.use(),t.bindBuffer(t.ARRAY_BUFFER,u);const o=[];i.forEach(t=>{o.push(...t.from,...t.to)}),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),e.setMat4("model_view_proj",r),e.setVec3("color",n),t.bindVertexArray(s),t.drawArrays(t.LINES,0,o.length/3),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null)}}function c(t){const n=[];for(let e=0;e<t.length;e+=2)n.push({from:t[e],to:t[(e+1)%t.length]});return n}function h(t,n=o.vec3.fromValues(1,0,0),e=o.vec3.fromValues(0,1,0),r=o.mat4.create()){const i=t.width/2,a=t.height/2;return{top_left:s.transform(s.sum(t.position,s.times(n,-i),s.times(e,a)),r),top_right:s.transform(s.sum(t.position,s.times(n,i),s.times(e,a)),r),bottom_right:s.transform(s.sum(t.position,s.times(n,i),s.times(e,-a)),r),bottom_left:s.transform(s.sum(t.position,s.times(n,-i),s.times(e,-a)),r)}}function f(t,n){return c([t.top_left,t.top_right,t.bottom_right,t.bottom_left,t.top_left,t.bottom_left,t.top_right,t.bottom_right,n.top_left,n.top_right,n.bottom_right,n.bottom_left,n.top_left,n.bottom_left,n.top_right,n.bottom_right,t.top_right,n.top_right,t.bottom_right,n.bottom_right,t.top_left,n.top_left,t.bottom_left,n.bottom_left])}function l(t){const n=t.depth/2;return f(h({position:s.sum(t.position,s.vec(0,0,n)),width:t.width,height:t.height}),h({position:s.sum(t.position,s.vec(0,0,-n)),width:t.width,height:t.height}))}n.createLineHelper=u,n.createArrowHelper=function(t,n=a.colors.blue){const e=u(t,n);return(t,...n)=>{const r=[];for(const{origin:t,dir:e,length:i}of n){const n=s.sum(t,s.times(s.normalize(e),i));r.push({from:t,to:n})}e(t,...r)}},n.createLines=c,n.createRectangle=h,n.createSquareFrustum=f,n.createBox=l,n.createBoxHelper=function(t,n=a.colors.red){const e=u(t,n);return(t,...n)=>{const r=[];for(const t of n)r.push(...l(t));e(t,...r)}},n.createFrustumHelper=function(t){const n=u(t,a.colors.yellow),e=u(t,a.colors.red),r=u(t,a.colors.green);return(t,...i)=>{const o=[],a=[],s=[];for(const t of i){const n=t.getDebugLines();o.push(...n.slice(0,4)),a.push(...n.slice(4,8)),s.push(...n.slice(8,12))}n(t,...o),e(t,...a),r(t,...s)}},n.createPrismHelper=function(t,n=a.colors.cyan){const e=u(t,n);return(t,...n)=>{const r=[];for(const t of n)r.push(t.a1,t.b1,t.b1,t.c1,t.c1,t.a1,t.a1,t.a2,t.b1,t.b2,t.c1,t.c2,t.a2,t.b2,t.b2,t.c2,t.c2,t.a2);e(t,...c(r))}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0);function i(t){return r.vec3.fromValues((t>>16&255)/255,(t>>8&255)/255,(255&t)/255)}n.hex2vec3=i,n.colors={black:i(0),white:i(16777215),red:i(16711680),green:i(65280),blue:i(255),yellow:i(16776960),cyan:i(65535),pink:i(16711935),orange:i(16747520)}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default=class{constructor(){this.eventHandlers=new Map}on(t,n){this.isListening(t)||this.eventHandlers.set(t,[]),this.eventHandlers.get(t).push(n)}isListening(t){return this.eventHandlers.has(t)}emit(t,n,e){if(this.isListening(t))for(const r of this.eventHandlers.get(t))r.call(e,n)}bindEvent(t,n){t.on(n,t=>this.emit(n,t))}removeListener(t){this.eventHandlers.delete(t)}removeListeners(){this.eventHandlers.clear()}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(2);function i(t,n=3){return new Float32Array(n).fill(t)}function o(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r]+n[r];return e}function a(...t){return t.reduce((t,n)=>o(t,n),i(0,t[0].length))}function s(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r]-n[r];return e}function u(t,n){return t.map(t=>t*n)}function c(t){return t.reduce((t,n)=>t+n**2,0)**.5}function h(t,n){const e=[];for(let r=0;r<n;r++)e.push(t);return e}n.g_vec=function(...t){return new Float32Array(t)},n.g_fill=i,n.g_add=o,n.g_sum=a,n.g_prod=function(...t){const n=i(1,t[0].length);for(const e of t)for(let t=0;t<n.length;t++)n[t]*=e[t];return n},n.g_div=function(t,n){const e=new Float32Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r]/n[r];return e},n.g_sub=s,n.g_times=u,n.g_clone=function(t){return new Float32Array(t.slice())},n.g_scale=u,n.g_centroid=function(...t){return n.g_scale(a(...t),1/t.length)},n.g_len=c,n.g_normalize=function(t){const e=c(t);return 0!==e?n.g_scale(t,1/e):i(0,t.length)},n.g_equals=function(t,n,e=1e-6){return t.length===n.length&&t.every((t,r)=>Math.abs(t-n[r])<e)},n.g_dot=function(t,n){return t.reduce((t,e,r)=>t+e*n[r],0)},n.dist=function(t,n){return c(s(t,n))},n.fillArray=h,n.getBoundingBox=function(...t){const n=t[0].length,e=h(1/0,n),r=h(-1/0,n);for(const i of t)for(let t=0;t<n;t++)i[t]<e[t]?e[t]=i[t]:i[t]>r[t]&&(r[t]=i[t]);return{min:e,max:r}},n.mapBox=function(t,n,e){const i=t.length,o=[];for(let a=0;a<i;a++)o[a]=r.mapIntervals(t[a],n.min[a],n.max[a],e.min[a],e.max[a]);return o}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(3),i=e(23),o=e(24),a=e(25),s=e(26);!function(t){let n=0;t.generate=function(t,e,i,o){e instanceof r.default||(e=new r.default(t,e));const a=t.createVertexArray(),s=t.createBuffer();t.bindVertexArray(a),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,1,1,-1,1,-1,-1]),t.STATIC_DRAW);const u=e.getAttribLocation("position");t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u),t.bindBuffer(t.ARRAY_BUFFER,null);const c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c),this.texture=t.createTexture();const h=n++;return t.activeTexture(t.TEXTURE0+h),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,i,o,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("ERROR::FRAMEBUFFER:: Framebuffer is not complete"),t.disable(t.DEPTH_TEST),t.viewport(0,0,i,o),t.clearColor(0,1,.5,1),t.clear(t.COLOR_BUFFER_BIT),e.use(),t.bindVertexArray(a),t.drawArrays(t.TRIANGLES,0,6),t.deleteVertexArray(a),t.deleteBuffer(s),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.DEPTH_TEST),{handle:this.texture,boundTo:h,width:i,height:o}},t.remove=function(t,n){t.deleteTexture(n.handle)},t.bind=function(t,n,e){t.bindTexture(t.TEXTURE0+e,n.handle)},t.toCanvas=function(t,n,e){const i=document.createElement("canvas"),o=i.getContext("webgl2"),a=t instanceof r.default?t:new r.default(o,t);i.width=n,i.height=e,a.use();const s=a.getAttribLocation("position"),u=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),o.STATIC_DRAW),o.enableVertexAttribArray(s),o.vertexAttribPointer(s,2,o.FLOAT,!1,0,0),o.viewport(0,0,n,e),o.drawArrays(o.TRIANGLES,0,6),o.deleteBuffer(u),i},t.toURL=function(n,e,r){return new Promise(i=>{t.toCanvas(n,e,r).toBlob(t=>{i(URL.createObjectURL(t))})})},t.getImage=function(n,e,r){return new Promise(i=>{t.toURL(n,e,r).then(t=>{const n=new Image;n.onload=(()=>{URL.revokeObjectURL(t),i(n)}),n.src=t})})},t.openInWindow=function(n,e,r,i="Texture Visualizer"){t.toURL(n,e,r).then(t=>{window.open(t,i,`menubar=no,\n                location=no,\n                resizable=yes,\n                scrollbars=no,\n                status=no,\n                width=${e},\n                height=${r}\n            `),window.setTimeout(()=>{URL.revokeObjectURL(t)},500)})},t.generatePlainColorTexture=function(n,e,i,o){const s=new r.default(n,a.plainColorShader);return s.use(),s.setVec3("u_color",o),t.generate(n,s,e,i)},t.generateHeightMap=function(n,e,r){return t.generate(n,i.terrainShader,e,r)},t.generateColorMap=function(n,e){const i=new r.default(n,s.heightMapToColorMapShader);return i.use(),i.setInt("height_map",e.boundTo),t.generate(n,i,e.width,e.height)},t.generateNormalMap=function(n,e){const i=new r.default(n,o.normalMapShader);return i.use(),i.setInt("height_map",e.boundTo),t.generate(n,i,e.width,e.height)}}(n.Texture||(n.Texture={}))},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(10),o=e(11),a=e(4),s=e(5),u=e(2),c=e(1),h=e(18),f=e(7),l=e(21),d=e(22);class v{constructor(t){this.gl=t,this.mode=0,this.culling=!0,this.needs_redraw=!0,this.update_on_move=!0,this.render_debug=!1,this.render_text=!0,this.fps_history=[],this.clock=new i.default,this.universe=new l.default;const n=this.universe.add(new d.default(t,{sphere_options:{radius:6371,max_lod:5,patch_levels:3,max_edge_size:100}}));this._sphere=this.universe.planets.get(n).sphere,this._player=new o.default({position:c.vec(0,0,3*this._sphere.radius)}),this._player.on("keydown",t=>this.onKeyDown.call(this,t)),window.addEventListener("resize",()=>{this.onResize.call(this,window.innerWidth,window.innerHeight)}),this.setCulling(this.culling),this.drawFrustum=a.createFrustumHelper(t),this.drawBoundingBox=a.createBoxHelper(t,s.colors.pink),this.drawPrism=a.createPrismHelper(t,s.colors.white),this.drawText=h.createTextHelper(t,{color:"tomato",font_size:20,font_family:"monospace, sans-serif"}),this.drawPlot=h.createPlotHelper(t,{width:150,height:70,auto_scale:!1,normalized:!0,background_color:"black",color:"white"})}computeModelViewProjMatrix(){const t=this._sphere.modelMatrix,n=this._player.camera.viewMatrix,e=this._player.camera.projectionMatrix;return u.combineMatrices(e,n,t)}start(){this.update(),requestAnimationFrame(()=>{this.start.call(this)})}setCulling(t=!0){this.culling=t,this.culling?(this.gl.enable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CW)):this.gl.disable(this.gl.CULL_FACE)}onKeyDown(t){switch(t.key.toLocaleLowerCase()){case"m":this.mode=(this.mode+1)%v.DRAWING_MODES.length,this.needs_redraw=!0;break;case"c":this.setCulling(!this.culling),this.needs_redraw=!0;break;case"f":this.render_debug=!this.render_debug,this.needs_redraw=!0;break;case"u":this.update_on_move=!this.update_on_move,this.needs_redraw=!0;break;case"t":this.render_text=!this.render_text,this.needs_redraw=!0}}onResize(t,n){this._player.camera.aspectRatio=t/n,this._sphere.updateLookUpTables(this._player.camera),this.needs_redraw=!0}clearGL(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this._sphere.render(this._player.camera,v.DRAWING_MODES[this.mode])}updateFPS(t){this.fps_history.length>120&&this.fps_history.splice(0,this.fps_history.length-120),this.fps_history.push(t)}update(){const t=this.clock.getDelta();return this.needs_redraw=this._player.update(t,this._sphere)||!this.update_on_move||this.needs_redraw,this.needs_redraw?(this.needs_redraw=!1,this._sphere.update(this._player.camera),this.updateFPS(t),this.clearGL(),this.debug(),this.renderText(),!0):this.needs_redraw=!1}renderText(){if(this.render_text){const t=this.drawText(`patches: ${this._sphere.patch.instancesCount}`,c.vec(0,0,0)),n=(1e3/u.average(...this.fps_history)).toPrecision(2),e=(1e3/Math.max(...this.fps_history)).toPrecision(2);this.drawText(`avg fps: ${n}`,c.vec(0,t.height,0)),this.drawText(`min fps: ${e}`,c.vec(0,2*t.height,0));const r=this.fps_history.map((t,n)=>f.g_vec(n/this.fps_history.length,t/60));this.drawPlot(c.vec(0,3*t.height,0),...r)}}debug(){if(this.render_debug){const t=this.computeModelViewProjMatrix();this.drawFrustum(t,this._player.camera.frustum),r.mat4.scale(t,t,c.fill(1/this._sphere.radius)),this.drawBoundingBox(t,this._sphere.boundingBox)}}}v.DRAWING_MODES=[WebGL2RenderingContext.TRIANGLES,WebGL2RenderingContext.POINTS],n.default=v,window.Main=v},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default=class{constructor(){this.last_tick=Date.now()}getDelta(){const t=Date.now(),n=t-this.last_tick;return this.last_tick=t,n}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(12),i=e(6),o=e(16),a=e(0),s=e(2),u=e(1);var c;!function(t){t[t.MOUSE_KEYBOARD=0]="MOUSE_KEYBOARD"}(c=n.PlayerControls||(n.PlayerControls={}));n.default=class extends i.default{constructor(t,n=document){super(),this._options=Object.assign({position:u.fill(0),orientation:a.quat.create(),FOV:s.radians(45),view_distance:2e7,controls:c.MOUSE_KEYBOARD},t),this._camera=new r.default(this._options.position,this._options.FOV,window.innerWidth/window.innerHeight,.1,this._options.view_distance),this._camera.orientation=this._options.orientation,this.initController(n)}initController(t){switch(this._options.controls){case c.MOUSE_KEYBOARD:default:this._controller=new o.default(this._camera,t),this.bindEvent(this._controller,"move"),this.bindEvent(this._controller,"turn"),this.bindEvent(this._controller,"keydown")}}update(t,n){const e=s.getNormalizedAltitude(this.position,n.center,n.radius),r=this._controller.update(t,e);return r&&this._camera.updateFrustum(n.inverseModelMatrix),r}get camera(){return this._camera}get position(){return this._camera.position}get FOV(){return this._camera.FOV}get controller(){return this._controller}dispose(){this._controller.dispose()}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(1),o=e(13);n.default=class{constructor(t,n,e,i,a){this._position=t,this._FOV=n,this._near=i,this._far=a,this._aspect=e,this._proj_matrix=r.mat4.create(),this._view_matrix=r.mat4.create(),this.updateProjectionMatrix(),this._basis={up:r.vec3.fromValues(0,1,0),right:r.vec3.fromValues(1,0,0),front:r.vec3.fromValues(0,0,-1)},this._orientation=r.quat.create(),this._frustum=new o.default(this)}updateProjectionMatrix(){r.mat4.perspective(this._proj_matrix,this._FOV,this._aspect,this._near,this._far)}move(t){r.vec3.add(this._position,this._position,t)}lookAt(t,n){const e=i.sum(this._position,t);r.mat4.lookAt(this._view_matrix,this._position,e,n)}get projectionMatrix(){return this._proj_matrix}get viewMatrix(){return this._view_matrix}get position(){return this._position}get FOV(){return this._FOV}set FOV(t){this._FOV=t,this.updateProjectionMatrix()}get aspectRatio(){return this._aspect}set aspectRatio(t){this._aspect=t,this.updateProjectionMatrix()}get near(){return this._near}get far(){return this._far}get front(){return this._basis.front}get orientation(){return this._orientation}set orientation(t){this._orientation.set(t),this.updateBasis()}get frustum(){return this._frustum}updateFrustum(t){this._frustum.update(t)}updateBasis(){this._basis.front=i.rotate([0,0,-1],this._orientation),this._basis.right=i.rotate([1,0,0],this._orientation),this._basis.up=i.cross(this._basis.right,this._basis.front)}get basis(){return this._basis}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(1),i=e(14),o=e(4);n.default=class{constructor(t){this.camera=t,this.planes=[]}update(t){const n=t,e=Math.tan(this.camera.FOV),a=this.camera.aspectRatio,s=e*this.camera.near,u=s/a,c=e*this.camera.far*.5,h=c/a,f=this.camera.basis,l=r.sum(this.camera.position,r.times(f.front,.5*this.camera.far)),d=r.sum(this.camera.position,r.times(f.front,this.camera.near)),v=r.transform(r.sum(d,r.times(f.up,u),r.times(f.right,-s)),n),m=r.transform(r.sum(d,r.times(f.up,u),r.times(f.right,s)),n),_=r.transform(r.sum(d,r.times(f.up,-u),r.times(f.right,-s)),n),p=r.transform(r.sum(d,r.times(f.up,-u),r.times(f.right,s)),n),g=r.transform(r.sum(l,r.times(f.up,h),r.times(f.right,-c)),n),M=r.transform(r.sum(l,r.times(f.up,h),r.times(f.right,c)),n),b=r.transform(r.sum(l,r.times(f.up,-h),r.times(f.right,-c)),n),x=r.transform(r.sum(l,r.times(f.up,-h),r.times(f.right,c)),n);this.planes=[new i.Plane(v,m,_),new i.Plane(M,g,x),new i.Plane(g,v,b),new i.Plane(m,M,p),new i.Plane(g,M,v),new i.Plane(_,p,b)],this.debug_lines=o.createLines([v,m,p,m,p,_,v,_,g,M,x,M,x,b,g,b,v,g,m,M,_,b,p,x])}getPlanes(){return this.planes}containsPoint(t){for(let n of this.planes)if(n.distanceToPoint(t)<0)return!1;return!0}containsTriangle(t,n,e){for(const r of this.planes)if(r.distanceToPoint(t)<0&&r.distanceToPoint(n)<0&&r.distanceToPoint(e)<0)return!1;return!0}containsPrism(t){return this.containsTriangle(t.a1,t.b1,t.c1)||this.containsTriangle(t.a2,t.b2,t.c2)}getDebugLines(){return this.debug_lines}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(1);n.Plane=class{constructor(t,n,e){if(this._point=t,this._normal=i.normalize(i.cross(i.sub(n,t),i.sub(e,t))),r.vec3.equals(this._normal,i.fill(0)))throw new Error("Cannot construct a plane with aligned points");this._dist_to_origin=-r.vec3.dot(this._point,this._normal)}distanceToPoint(t){return r.vec3.dot(this._normal,t)+this._dist_to_origin}containsPoint(t,n=1e-4){return Math.abs(r.vec3.dot(i.sub(t,this._point),this._normal))<n}get point(){return this._point}get normal(){return this._normal}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.wireFrameShader={vertex:"#version 300 es\n    in vec3 position;\n\n    uniform mat4 model_view_proj;\n\t\n\tvoid main() {\n\t\tgl_Position = model_view_proj * vec4(position, 1.0f);\n\t}\n    ",fragment:"#version 300 es\n    precision mediump float;\n\n    uniform vec3 color;\n\n    out vec4 frag_color;\n    \n    void main() {\n        frag_color = vec4(color, 1.0);\n    }"}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(6),i=e(17),o=e(0),a=e(2),s=e(1);n.default=class extends r.default{constructor(t,n,e=10,r=.1){if(super(),this._layout=i.KeyboardLayout.CLASSICAL,this._needs_update=!0,this._pointerLockEnabled=!1,this.camera=t,this.domElement=n,this._speed=e,this._mouse_sensitivity=r,!i.KeyboardLayoutMaps.has(this._layout))throw new Error(`No Key mapping for '${i.KeyboardLayout[this._layout]}' defined in 'KeyboardLayoutMaps'`);this._key_map=i.KeyboardLayoutMaps.get(this._layout),this._actions=new Map,this.domElement.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.domElement.addEventListener("keyup",this.onKeyUp.bind(this),!1),this.domElement.addEventListener("mousemove",this.onMouseMove.bind(this),!1),this.domElement.addEventListener("pointerlockchange",this.onPointerLockChange.bind(this),!1),this.domElement.addEventListener("pointerlockerror",this.onPointerLockError.bind(this),!1)}actionPerformed(t,n){return this._key_map[t].some(t=>t===n)}updateActions(t,n){for(let e in this._key_map)this.actionPerformed(e,t)&&this._actions.set(e,n)}onKeyDown(t){this.emit("keydown",t),this.updateActions(t.code,!0)}onKeyUp(t){this.emit("keyup",t),this.updateActions(t.code,!1)}onPointerLockChange(t){this.emit("pointerlockchange",t),this._pointerLockEnabled=!this._pointerLockEnabled}onPointerLockError(t){this.emit("pointerlockerror",t),console.error("Pointer Lock Error")}onMouseMove(t){if(!this._pointerLockEnabled)return;const n=a.radians(t.movementX*this._mouse_sensitivity),e=a.radians(t.movementY*this._mouse_sensitivity),r=this.camera.orientation;o.quat.rotateX(r,r,-e),o.quat.rotateY(r,r,-n),this.camera.orientation=r,this.emit("turn",t),this._needs_update=!0}dispose(){this.domElement.removeEventListener("keydown",this.onKeyDown.bind(this),!1),this.domElement.removeEventListener("keyup",this.onKeyUp.bind(this),!1),this.domElement.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),this.domElement.removeEventListener("pointerlockchange",this.onPointerLockChange.bind(this),!1),this.domElement.removeEventListener("pointerlockerror",this.onPointerLockError.bind(this),!1),this.removeListeners()}onMove(t){this.on("move",t)}onTurn(t){this.on("turn",t)}update(t,n){const e=t*this._speed*n,r=this.camera.basis;let i=o.vec3.create(),a=!1;this._actions.get("forward")&&(o.vec3.add(i,i,r.front),a=!0),this._actions.get("backward")&&(o.vec3.sub(i,i,r.front),a=!0),this._actions.get("right")&&(o.vec3.add(i,i,r.right),a=!0),this._actions.get("left")&&(o.vec3.sub(i,i,r.right),a=!0),this._actions.get("up")&&(o.vec3.add(i,i,r.up),a=!0),this._actions.get("down")&&(o.vec3.sub(i,i,r.up),a=!0),this.camera.lookAt(r.front,r.up),this.camera.move(s.scale(s.normalize(i),e)),a&&this.emit("move",i);const u=a||this._needs_update;return this._needs_update=!1,u}}},function(t,n,e){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.CLASSICAL=0]="CLASSICAL"}(r=n.KeyboardLayout||(n.KeyboardLayout={})),n.KeyboardLayoutMaps=new Map,n.KeyboardLayoutMaps.set(r.CLASSICAL,{forward:["KeyW","ArrowUp"],backward:["KeyS","ArrowDown"],left:["KeyA","ArrowLeft"],right:["KeyD","ArrowRight"],up:["Space"],down:["ShiftLeft","ShiftRight"]})},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(7),i=e(19),o=document.createElement("canvas").getContext("2d");n.createTextHelper=function(t,n){const e=i.createCanvasHelper(t);let r,a;return(t,i)=>(a!==t&&(a=t,r=function(t,n){const e=Object.assign({color:"tomato",font_size:35,font_family:"monospace, sans-serif",margin:5,background_color:"rgba(0, 0, 0, 255)"},n);o.font=`${e.font_size}px ${e.font_family}`;const r=o.measureText(t).width+e.margin,i=e.font_size+e.margin;return o.canvas.width=r,o.canvas.height=i,o.font=`${e.font_size}px ${e.font_family}`,o.textAlign="center",o.textBaseline="middle",o.fillStyle=e.background_color,o.fillRect(0,0,r,i),o.fillStyle=e.color,o.fill(),o.fillText(t,r/2,i/2),o.canvas}(t,n)),e(r,i),{width:r.width,height:r.height})},n.createPlotHelper=function(t,n){const e=i.createCanvasHelper(t),o=document.createElement("canvas");o.width=n.width,o.height=n.height;const a=o.getContext("2d");return n=Object.assign({color:"blue",background_color:"white",line_width:1,auto_scale:!0,normalized:!1},n),(t,...i)=>{if(n.normalized&&(i=i.map(t=>r.g_prod(t,[o.width,o.height]))),n.auto_scale){const t=r.getBoundingBox(...i);i=i.map(e=>r.mapBox(e,t,{min:[0,0],max:[n.width,n.height]}))}a.clearRect(0,0,o.width,o.height),a.fillStyle=n.background_color,a.fillRect(0,0,o.width,o.height),a.fill(),a.strokeStyle=n.color,a.beginPath(),a.moveTo(i[0][0],i[0][1]);for(const t of i.slice(1))a.lineTo(t[0],t[1]);a.stroke(),a.closePath(),e(o,t)}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(3),i=e(20),o=e(0),a=e(1);n.createCanvasHelper=function(t){const n=new r.default(t,i.textShader);n.use();const e=t.createVertexArray();t.bindVertexArray(e);const s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const u=n.getAttribLocation("position");t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u);const c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW);const h=n.getAttribLocation("texcoords");t.vertexAttribPointer(h,2,t.FLOAT,!0,0,0),t.enableVertexAttribArray(h),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindVertexArray(null);const f=t.createTexture();return(r,i)=>{t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,f),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D);const s=o.mat4.create();o.mat4.translate(s,s,a.div(a.vec(i[0],t.canvas.height-r.height-i[1],0),a.vec(t.canvas.width,t.canvas.height,1))),o.mat4.scale(s,s,[r.width/t.canvas.width,r.height/t.canvas.height,1]),n.use(),t.bindTexture(t.TEXTURE_2D,f),n.setInt("u_texture",2),n.setMat4("transfo",s),t.bindVertexArray(e),t.drawArrays(t.TRIANGLES,0,6),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.textShader={vertex:"#version 300 es\n    in vec4 position;\n    in vec2 texcoords;\n    \n    uniform mat4 transfo;\n    \n    out vec2 v_texcoord;\n    \n    void main() {\n      gl_Position = transfo * (position * 2.0) - 1.0;\n  \n      v_texcoord = texcoords;\n    }\n    ",fragment:"#version 300 es\n    precision mediump float;\n    \n    uniform sampler2D u_texture;\n    in vec2 v_texcoord;\n    \n    out vec4 outColor;\n    \n    void main() {\n\n      vec4 color = texture(u_texture, v_texcoord);\n      \n/*       if (color.rgb == vec3(0.0)) {\n        discard;\n      } */\n\n      outColor = vec4(color);\n    }\n    "}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default=class{constructor(){this._planets=new Map}add(t){return this._planets.set(t.ID,t),t.ID}update(t){for(const n of this._planets.values())n.update(t)}render(t,n){for(const e of this._planets.values())e.render(t,n)}get planets(){return this._planets}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(8),i=e(27);var o;!function(t){t[t.IcoSphere=0]="IcoSphere"}(o=n.SphereType||(n.SphereType={}));n.default=class{constructor(t,n={}){this.gl=t,this._options=Object.assign({sphere_options:{},textures:{}},n),void 0===this._options.textures.height_map&&(this._options.textures.height_map=r.Texture.generateHeightMap(t,1024,512)),this.initSphere()}initSphere(){switch(this._sphere_type){case o.IcoSphere:default:this._sphere=new i.default(this.gl,this._options.sphere_options)}}update(t){this._sphere.update(t)}render(t,n){this._sphere.render(t,n)}get ID(){return this._sphere.ID}get sphere(){return this._sphere}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.terrainShader={vertex:"#version 300 es\n    in vec2 position;\n    \n    out vec2 a_pos;\n    \n    void main() {\n        a_pos = position;\n        gl_Position = vec4(position, 0, 1);\n    }",fragment:"#version 300 es\n    precision mediump float;\n\n    #define FREQUENCY 2.0\n    #define OCTAVES 8\n\n    in vec2 a_pos;\n    out vec4 color;\n    \n    //\n    // Description : Array and textureless GLSL 2D/3D/4D simplex\n    //               noise functions.\n    //      Author : Ian McEwan, Ashima Arts.\n    //  Maintainer : stegu\n    //     Lastmod : 20110822 (ijm)\n    //     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n    //               Distributed under the MIT License. See LICENSE file.\n    //               https://github.com/ashima/webgl-noise\n    //               https://github.com/stegu/webgl-noise\n    //\n    //\n    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\n    vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n    \n    float snoise(vec3 v){\n      const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n      const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    \n    // First corner\n      vec3 i  = floor(v + dot(v, C.yyy) );\n      vec3 x0 =   v - i + dot(i, C.xxx) ;\n    \n    // Other corners\n      vec3 g = step(x0.yzx, x0.xyz);\n      vec3 l = 1.0 - g;\n      vec3 i1 = min( g.xyz, l.zxy );\n      vec3 i2 = max( g.xyz, l.zxy );\n    \n      //  x0 = x0 - 0. + 0.0 * C\n      vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n      vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n      vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n    \n    // Permutations\n      i = mod(i, 289.0 );\n      vec4 p = permute( permute( permute(\n                 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n               + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n               + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients\n    // ( N*N points uniformly over a square, mapped onto an octahedron.)\n      float n_ = 1.0/7.0; // N=7\n      vec3  ns = n_ * D.wyz - D.xzx;\n    \n      vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n    \n      vec4 x_ = floor(j * ns.z);\n      vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n      vec4 x = x_ *ns.x + ns.yyyy;\n      vec4 y = y_ *ns.x + ns.yyyy;\n      vec4 h = 1.0 - abs(x) - abs(y);\n    \n      vec4 b0 = vec4( x.xy, y.xy );\n      vec4 b1 = vec4( x.zw, y.zw );\n    \n      vec4 s0 = floor(b0)*2.0 + 1.0;\n      vec4 s1 = floor(b1)*2.0 + 1.0;\n      vec4 sh = -step(h, vec4(0.0));\n    \n      vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n      vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n      vec3 p0 = vec3(a0.xy,h.x);\n      vec3 p1 = vec3(a0.zw,h.y);\n      vec3 p2 = vec3(a1.xy,h.z);\n      vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n      vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n      p0 *= norm.x;\n      p1 *= norm.y;\n      p2 *= norm.z;\n      p3 *= norm.w;\n    \n    // Mix final noise value\n      vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n      m = m * m;\n      return (42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                    dot(p2,x2), dot(p3,x3) ) ));\n    }\n    \n    float fbm(in vec3 st) {\n         // Initial values\n         float value = 0.0f;\n         float amplitude = 0.5f;\n         // Loop of octaves\n         for (int i = 0; i < OCTAVES; i++) {\n             value += amplitude * snoise(st);\n             st *= 2.0f;\n             amplitude *= 0.5f;\n         }\n    \n     return value;\n    }\n    \n    vec3 spherize(vec2 st) {\n        float theta = st.y * 3.14159265359;\n        float phi = st.x * 6.28318530718;\n        float cos_theta = cos(theta);\n        float cos_phi = cos(phi);\n        float sin_theta = sin(theta);\n        float sin_phi = sin(phi);\n        float x = sin_theta * cos_phi;\n        float y = sin_theta * sin_phi;\n        float z = cos_theta;\n    \n        return vec3(x, y, z);\n    }\n    \n    vec3 getTerrainColor(float n) {\n\n      if (n < 0.5f) {\n          n = 0.5f;\n          //return vec3(0.0, 0.5, 0.5);\n          return vec3(0.302f, 0.388f, 0.714f); //water\n      } else if (n < 0.7f){\n          return mix(vec3(0.239f, 0.614f, 0.214f), vec3(0.686f, 0.671f, 0.412f), smoothstep(0.52f, 0.7f, n)); //land\n      } else {\n          return mix(vec3(0.686f, 0.671f, 0.412f), vec3(0.949f, 0.949f, 0.949f), smoothstep(0.7f, 1.0f, n)); //mountains\n      }\n  }\n\n    void main() {\n    \n        vec2 st = a_pos * 0.5f + 0.5f;\n    \n        float n = fbm(spherize(st) * FREQUENCY) * 0.5f + 0.5f;\n\n        n = clamp(n, 0.499f, 1.0f);\n        //n = pow(n, 4.0f);\n    \n        color = vec4(vec3(n), 1.0f);\n        //color = vec4(1.0, 0.0, 1.0, 1.0);\n    }\n    "}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.normalMapShader={vertex:"#version 300 es\n    in vec2 position;\n\n    out vec2 a_pos;\n\n    void main() {\n        a_pos = position * 0.5f + 0.5f;\n        gl_Position = vec4(position, 0.0, 1.0);\n    }\n    ",fragment:"#version 300 es\n    precision mediump float;\n\n    //#define USE_SOBEL\n    #define SENSITIVITY 0.9f\n    \n    in vec2 a_pos;\n    \n    out vec4 FragColor;\n    \n    uniform sampler2D height_map;\n    \n    void main() {\n    \n        vec2 uv = a_pos;\n        vec3 n;\n    \n        #ifdef USE_SOBEL\n            float h00 = textureOffset(height_map, uv, ivec2(-1, -1)).r;\n            float h10 = textureOffset(height_map, uv, ivec2(0, -1)).r;\n            float h20 = textureOffset(height_map, uv, ivec2(1, -1)).r;\n            float h01 = textureOffset(height_map, uv, ivec2(-1, 0)).r;\n            float h21 = textureOffset(height_map, uv, ivec2(1, 0)).r;\n            float h02 = textureOffset(height_map, uv, ivec2(-1, 1)).r;\n            float h12 = textureOffset(height_map, uv, ivec2(0, 1)).r;\n            float h22 = textureOffset(height_map, uv, ivec2(1, 1)).r;\n    \n            float Gx = h00 - h20 + 2.0f * h01 - 2.0f * h21 + h02 - h22;\n            float Gy = h00 + 2.0f * h10 + h20 - h02 - 2.0f * h12 - h22;\n            float Gz = SENSITIVITY * sqrt(1.0f - Gx * Gx - Gy * Gy);\n            n = vec3(2.0f * Gx, 2.0f * Gy, Gz);\n        #else\n            float h0 = texture(height_map, uv).r;\n            float h1 = textureOffset(height_map, uv, ivec2(1, 0)).r;\n            float h2 = textureOffset(height_map, uv, ivec2(0, 1)).r;\n    \n            vec3 v01 = vec3(1.0, 0.0, h1 - h0);\n            vec3 v02 = vec3(0, 1, h2 - h0);\n    \n            n = cross(v01, v02);\n            n.z *= SENSITIVITY;\n        #endif\n    \n        n = normalize(n) * 0.5f + 0.5f;\n\n        FragColor = vec4(n, 1.0f);\n    }\n    "}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.plainColorShader={vertex:"#version 300 es\n    in vec4 position;\n    \n    void main() {\n        gl_Position = position;\n    }\n    ",fragment:"#version 300 es\n    precision mediump float;\n\n    uniform vec3 u_color;\n    out vec4 frag_color;\n    \n    void main() {\n        frag_color = vec4(u_color, 1.0);\n    }"}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.heightMapToColorMapShader={vertex:"#version 300 es\n    in vec2 position;\n    \n    out vec2 v_texcoord;\n    \n    void main() {\n        v_texcoord = position * 0.5f + 0.5f;\n        gl_Position = vec4(position, 0.0, 1.0);\n    }\n    ",fragment:"#version 300 es\n    precision mediump float;\n\n    in vec2 v_texcoord;\n\n    uniform sampler2D height_map;\n\n    out vec4 frag_color;\n    \n    vec3 getTerrainColor(float n) {\n\n        if (n < 0.5f) {\n            n = 0.5f;\n            //return vec3(0.0, 0.5, 0.5);\n            return vec3(0.302f, 0.388f, 0.714f); //water\n        } else if (n < 0.7f){\n            return mix(vec3(0.239f, 0.614f, 0.214f), vec3(0.686f, 0.671f, 0.412f), smoothstep(0.52f, 0.7f, n)); //land\n        } else {\n            return mix(vec3(0.686f, 0.671f, 0.412f), vec3(0.949f, 0.949f, 0.949f), smoothstep(0.7f, 1.0f, n)); //mountains\n        }\n    }\n\n    void main() {\n        vec3 color = getTerrainColor(texture(height_map, v_texcoord).r);\n        frag_color = vec4(color, 1.0);\n    }"}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(2),o=e(8),a=e(1),s=e(28),u=e(29);class c{constructor(t,n={}){this._ID=c.count++,this.first_update=!0,this._faces=[new s.default(0,11,5,this),new s.default(0,5,1,this),new s.default(0,1,7,this),new s.default(0,7,10,this),new s.default(0,10,11,this),new s.default(1,5,9,this),new s.default(5,11,4,this),new s.default(11,10,2,this),new s.default(10,7,6,this),new s.default(7,1,8,this),new s.default(3,9,4,this),new s.default(3,4,2,this),new s.default(3,2,6,this),new s.default(3,6,8,this),new s.default(3,8,9,this),new s.default(4,9,5,this),new s.default(2,4,11,this),new s.default(6,2,10,this),new s.default(8,6,7,this),new s.default(9,8,1,this)],this._options=Object.assign({radius:1,center:a.fill(0),orientation:r.quat.create(),max_lod:6,patch_levels:4,max_terrain_height:400,max_edge_size:150,morph_range:.5},n),this._vertices=[...c._icosahedron_vertices],this.computeModelMatrix(),this._patch=new u.default(t,this),this._vertex_index_map=new Map,void 0===this._options.height_map&&(this._options.height_map=o.Texture.generateHeightMap(t,1024,512))}init(t){this.updateLookUpTables(t),this._patch.init()}updateLookUpTables(t){this.generateFaceCullingAnglesLUT(),this.generateSplitDistancesLUT(t.FOV)}generateSplitDistancesLUT(t){let n=r.vec3.dist(this.getVertex(0),this.getVertex(1));const e=[];for(let r=0;r<this._options.max_lod;r++){const i=this._options.max_edge_size/window.innerWidth;e[r]=n/Math.tan(i*t),n/=2}this._SPLIT_DIST_LUT=e}generateFaceCullingAnglesLUT(){let t=[];const n=Math.acos(this._options.radius/(this._options.radius+this._options.max_terrain_height));let e=Math.PI/3+n;for(let n=0;n<=this._options.max_lod;n++)t.push(Math.sin(e)),e/=2;this._FACE_CULLING_ANGLES=t}computeModelMatrix(){this._model_matrix=r.mat4.create(),r.mat4.fromRotationTranslationScale(this._model_matrix,this._options.orientation,this._options.center,a.fill(this._options.radius)),this._inv_model_matrix=i.invert(this._model_matrix)}update(t){this.first_update&&(this.first_update=!1,this.init(t));for(let n of this.faces)n.updatePatchInstances(t);this.patch.bindInstances()}render(t,n){this.patch.render(t,n)}addPatchInstance(t){this.patch.pushInstance(t)}get vertices(){return this._vertices}get modelMatrix(){return this._model_matrix}get inverseModelMatrix(){return this._inv_model_matrix}getSplitDistance(t){if(void 0===this._SPLIT_DIST_LUT)throw new Error("call generateSplitDistanceLUT() before getSplitDistLUT()");return this._SPLIT_DIST_LUT[t]}getFaceCullingAngle(t){return this._FACE_CULLING_ANGLES[t]}getVertex(t){return r.vec3.fromValues(this._vertices[3*t],this._vertices[3*t+1],this._vertices[3*t+2])}get radius(){return this._options.radius}getVertexHash(t,n=5){return`${t[0].toFixed(n)}:${t[1].toFixed(n)}:${t[2].toFixed(n)}`}addVertex(t){const n=this.getVertexHash(t);if(this._vertex_index_map.has(n))return this._vertex_index_map.get(n);this._vertices.push(...t);const e=this._vertices.length/3-1;return this._vertex_index_map.set(n,e),e}get heightMap(){return this._options.height_map}get center(){return this._options.center}get options(){return this._options}get boundingBox(){return{position:this._options.center,width:2*this._options.radius,height:2*this._options.radius,depth:2*this._options.radius}}get faces(){return this._faces}get patch(){return this._patch}get ID(){return this._ID}}c.count=0,c._icosahedron_vertices=[-.5257311121191336,.85065080835204,0,.5257311121191336,.85065080835204,0,-.5257311121191336,-.85065080835204,0,.5257311121191336,-.85065080835204,0,0,-.5257311121191336,.85065080835204,0,.5257311121191336,.85065080835204,0,-.5257311121191336,-.85065080835204,0,.5257311121191336,-.85065080835204,.85065080835204,0,-.5257311121191336,.85065080835204,0,.5257311121191336,-.85065080835204,0,-.5257311121191336,-.85065080835204,0,.5257311121191336],n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(1);class o{constructor(t,n,e,r,i=null){this._has_children=!1,this.a=t,this.b=n,this.c=e,this._sphere=r,this._parent=i,this._level=null!==i?this._parent.level+1:0}get level(){return this._level}get centroid(){return void 0===this._centroid&&(this._centroid=i.normalize(i.centroid(...[this.a,this.b,this.c].map(t=>this._sphere.getVertex(t))))),this._centroid}getMidPoint(t,n){const e=this._sphere.getVertex(t),i=this._sphere.getVertex(n),o=r.vec3.create();return r.vec3.lerp(o,e,i,.5),this._sphere.addVertex(o)}get boundingPrism(){if(void 0===this._bounding_prism){const t=this._sphere.options.max_terrain_height/this._sphere.radius,[n,e,r]=[this.a,this.b,this.c].map(t=>i.normalize(this._sphere.getVertex(t))),[o,a,s]=[n,e,r].map(n=>i.sum(n,i.times(i.normalize(n),t)));this._bounding_prism={a1:n,b1:e,c1:r,a2:o,b2:a,c2:s}}return this._bounding_prism}split(){if(this._has_children)return;const t=this.getMidPoint(this.a,this.b),n=this.getMidPoint(this.b,this.c),e=this.getMidPoint(this.a,this.c);this._children=[new o(t,e,this.a,this._sphere,this),new o(t,this.b,n,this._sphere,this),new o(this.c,e,n,this._sphere,this),new o(n,e,t,this._sphere,this)],this._has_children=!0}isVisible(t){const n=r.vec3.create(),e=r.vec3.create();return r.vec3.normalize(n,this.centroid),r.vec3.sub(e,n,t.position),r.vec3.normalize(e,e),!!(r.vec3.dot(n,e)<this._sphere.getFaceCullingAngle(this._level))&&t.frustum.containsPrism(this.boundingPrism)}hasChildren(){return this._has_children}get children(){return this._children}shouldSplit(t){if(this._level>=this._sphere.options.max_lod)return!1;const n=r.vec3.create();return r.vec3.scale(n,t.position,1/this._sphere.radius),r.vec3.dist(n,this.centroid)<this._sphere.getSplitDistance(this._level)}get patchInstance(){if(void 0===this._patchInstance){const t=this._sphere.getVertex(this.a),n=this._sphere.getVertex(this.b),e=this._sphere.getVertex(this.c),r=i.sub(n,t),o=i.sub(e,t);this._patchInstance={level:this._level,A:t,R:r,S:o}}return this._patchInstance}updatePatchInstances(t){if(this.isVisible(t))if(this.shouldSplit(t)){this.split();for(let n of this._children)n.updatePatchInstances(t)}else this._sphere.addPatchInstance(this.patchInstance)}}n.default=o},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(30),i=e(3),o=e(1);n.default=class{constructor(t,n){this.gl=t,this._sphere=n,this._shader=new i.default(t,r.patchShader),this._levels=n.options.patch_levels,this._instances=[],this._shader.attachTexture("height_map",0),this._shader.attachTexture("color_map",1),this._shader.attachTexture("normal_map",2)}initUniforms(){const t=o.normalize(o.vec(1,.7,.3));this._shader.setFloat("morph_range",this._sphere.options.morph_range),this._shader.setVec3("light_dir",t),this.uploadDistanceLUT()}uploadDistanceLUT(){this.gl.useProgram(this._shader.program);for(let t=0;t<this._sphere.options.max_lod;t++)this._shader.setFloat(`distanceLUT[${t}]`,this._sphere.getSplitDistance(t))}initAttributes(){this.attributes={pos:this._shader.getAttribLocation("pos"),morph:this._shader.getAttribLocation("morph"),barycentric:this._shader.getAttribLocation("barycentric"),level:this._shader.getAttribLocation("level"),A:this._shader.getAttribLocation("A"),R:this._shader.getAttribLocation("R"),S:this._shader.getAttribLocation("S")}}initBuffers(){this.VAO=this.gl.createVertexArray(),this.VBO=this.gl.createBuffer(),this.EBO=this.gl.createBuffer(),this.VBO_instance=this.gl.createBuffer(),this.gl.bindVertexArray(this.VAO),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.VBO),this.gl.enableVertexAttribArray(this.attributes.pos),this.gl.enableVertexAttribArray(this.attributes.morph),this.gl.enableVertexAttribArray(this.attributes.barycentric),this.gl.vertexAttribPointer(this.attributes.pos,2,this.gl.FLOAT,!1,28,0),this.gl.vertexAttribPointer(this.attributes.morph,2,this.gl.FLOAT,!1,28,8),this.gl.vertexAttribPointer(this.attributes.barycentric,3,this.gl.FLOAT,!1,28,16)}init(){this._shader.use(),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.initUniforms(),this.initAttributes(),this.initBuffers(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.VBO_instance),this.gl.enableVertexAttribArray(this.attributes.level),this.gl.enableVertexAttribArray(this.attributes.A),this.gl.enableVertexAttribArray(this.attributes.R),this.gl.enableVertexAttribArray(this.attributes.S),this.gl.vertexAttribPointer(this.attributes.level,1,this.gl.FLOAT,!1,40,0),this.gl.vertexAttribPointer(this.attributes.A,3,this.gl.FLOAT,!1,40,4),this.gl.vertexAttribPointer(this.attributes.R,3,this.gl.FLOAT,!1,40,16),this.gl.vertexAttribPointer(this.attributes.S,3,this.gl.FLOAT,!1,40,28),this.gl.vertexAttribDivisor(this.attributes.level,1),this.gl.vertexAttribDivisor(this.attributes.A,1),this.gl.vertexAttribDivisor(this.attributes.R,1),this.gl.vertexAttribDivisor(this.attributes.S,1),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.EBO),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindVertexArray(null),this.generateGeometry()}generateGeometry(){const t=[[1,0,0],[0,1,0],[0,0,1]];let n=0;this._vertices=[],this._indices=[];let e=[],r=[];const i=1+2**this._levels,o=1/(i-1);let a=0,s=0;for(let u=0;u<i;u++){const c=i-u;s+=c;for(let h=0;h<c;h++){const f=[h/(i-1),u/(i-1)],l=[0,0];u%2==0?h%2==1&&(l[0]=-o,l[1]=0):h%2==0?(l[0]=0,l[1]=o):(l[0]=o,l[1]=-o),e.push(...f),r.push(...l),this._vertices.push(...f,...l,...t[n++%3]),u<i-1&&h<c-1&&(this._indices.push(a+h),this._indices.push(s+h),this._indices.push(1+a+h),h<c-2&&(this._indices.push(s+h),this._indices.push(1+s+h),this._indices.push(1+a+h)))}a=s}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.VBO),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this._vertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.EBO),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(this._indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}bindInstances(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.VBO_instance),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this._instances),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}pushInstance(t){this._instances.push(t.level,...t.A,...t.R,...t.S)}updateUniforms(t,n){const e=o.scale(t.position,1/this._sphere.radius);this._shader.setMat4("model",this._sphere.modelMatrix),this._shader.setMat4("view",t.viewMatrix),this._shader.setMat4("projection",t.projectionMatrix),this._shader.setVec3("cam_pos",e),this._shader.setBool("points",n),this._shader.setFloat("time",Math.sin(Date.now()/5e3%(2*Math.PI))),this._shader.bindTextures()}render(t,n=this.gl.TRIANGLES){this._shader.use(),this.updateUniforms(t,n!==this.gl.TRIANGLES),this.gl.bindVertexArray(this.VAO),this.gl.drawElementsInstanced(n,this._indices.length,this.gl.UNSIGNED_INT,0,this._instances.length/10),this.gl.bindVertexArray(null),this._instances_count=this._instances.length,this._instances=[]}get instancesCount(){return this._instances_count}}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.patchShader={vertex:"#version 300 es\nprecision mediump float;\n\nin vec2 pos;\nin vec2 morph;\nin vec3 barycentric;\n\nin float level;\nin vec3 A;\nin vec3 R;\nin vec3 S;\n\nuniform mat4 model;\nuniform mat4 view;\nuniform mat4 projection;\n\nuniform sampler2D height_map;\n//uniform sampler2D normal_map;\n\nuniform vec3 cam_pos;\nuniform float morph_range;\nuniform float distanceLUT[32];\nuniform float time;\nuniform float radius;\nuniform bool points;\n\nout vec3 frag_pos;\nflat out int v_level;\nout vec3 v_barycentric;\nout vec2 uv;\n\nfloat getMorphFactor(float dist, int level) {\n    float low = distanceLUT[level - 1];\n    float high = distanceLUT[level];\n    \n    float a = (dist - low) / (high - low);\n\n    return 1.0 - clamp(a / morph_range, 0.0, 1.0);\n}\n\nfloat getHeight(vec3 pos) {\n    uv = vec2(atan(pos.z, pos.x), acos(pos.y)) / vec2(6.28318530718, 3.14159265359);\n    return texture(height_map, uv).r;\n}\n\nvoid main() {\n    v_barycentric = barycentric;\n    v_level = int(level);\n\n    vec3 tri_pos = A + R * pos.x + S * pos.y;\n    \n    float dist = distance(cam_pos, tri_pos);\n    float factor = getMorphFactor(dist, v_level);\n\n    tri_pos += factor * (R * morph.x + S * morph.y);\n    tri_pos = normalize(tri_pos);\n\n    float h = getHeight(tri_pos);\n    tri_pos += tri_pos * pow(h, 2.5f) * (400.0f / 6371.0f);\n    \n    frag_pos = (model * vec4(tri_pos, 0.0)).xyz;\n\n    gl_Position = projection * view * model * vec4(tri_pos, 1.0);\n    if (points) {\n        gl_PointSize = 2.0f;\n    }\n}\n",fragment:"#version 300 es\nprecision mediump float;\n\nin vec3 frag_pos;\nflat in int v_level;\nin vec3 v_barycentric;\nin vec2 uv;\n\nuniform bool points;\nuniform vec3 light_dir;\nuniform sampler2D height_map;\n//uniform sampler2D color_map;\n//uniform sampler2D normal_map;\n\nout vec4 frag_color;\n\nvec3 getFaceNormal() {\n    vec3 fdx = vec3(dFdx(frag_pos.x), dFdx(frag_pos.y), dFdx(frag_pos.z));\n    vec3 fdy = vec3(dFdy(frag_pos.x), dFdy(frag_pos.y), dFdy(frag_pos.z));\n    vec3 normal = normalize(cross(fdx, fdy));\n    return normal;\n}\n\nvec3 getLighting() {\n\n    vec3 color = vec3(0.0);\n\n    color = vec3(0.0);\n    vec3 normal = getFaceNormal();\n    //vec3 normal = normalize(texture(normal_map, uv).rgb * 2.0 - 1.0);\n    //vec3 normal = normalize(frag_pos);\n\n    //point light :\n    //vec3 light_dir = normalize(light_pos - frag_pos);\n\n    color += clamp(dot(light_dir, normal), 0.0, 1.0);\n\n    return color;\n}\n\nfloat edgeFactor(in vec3 vBC) {\n    vec3 d = fwidth(vBC);\n    vec3 a3 = smoothstep(vec3(0.0), d * 1.5, vBC);\n    return min(min(a3.x, a3.y), a3.z);\n}\n\nvec3 getLevelColor(const int level) {\n    if (level == 9) {\n        return vec3(1.0);\n    } if (level == 8) {\n        return vec3(0, 0.5, 0.5);\n    } else if (level == 7) {\n        return vec3(1.0, 0.0, 0.0);\n    } else if (level == 6) {\n        return vec3(0.0, 1.0, 0.0);\n    } else if (level == 5) {\n        return vec3(0.541, 0.169, 0.886);\n    } else if (level == 4) {\n        return vec3(1.0, 1.0, 0.0);\n    } else if (level == 3) {\n        return vec3(0.0, 1.0, 1.0);\n    } else if (level == 2) {\n        return vec3(1.0, 0.0, 1.0);\n    } else if (level == 1) {\n        return vec3(1.0);\n    } else if (level == 0) {\n        return vec3(1.0);\n    }\n\n    return vec3(1.0, 0.0, 1.0);\n}\n\nvec3 getTerrainColor(float n) {\n\n    if (n < 0.5f) {\n        n = 0.5f;\n        //return vec3(0.0, 0.5, 0.5);\n        return vec3(0.302f, 0.388f, 0.714f); //water\n    } else if (n < 0.7f){\n        return mix(vec3(0.239f, 0.614f, 0.214f), vec3(0.686f, 0.671f, 0.412f), smoothstep(0.52f, 0.7f, n)); //land\n    } else {\n        return mix(vec3(0.686f, 0.671f, 0.412f), vec3(0.949f, 0.949f, 0.949f), smoothstep(0.7f, 1.0f, n)); //mountains\n    }\n}\n\nvoid main() {\n\n    vec3 color;\n    \n    if (points) {\n        color = getLevelColor(v_level);\n    } else {\n        //color = v_barycentric;\n        //color = mix(vec3(0.0), vec3(1.0, 0.0, 1.0), edgeFactor(v_barycentric));\n        vec3 terrain_color = getTerrainColor(texture(height_map, uv).r);\n        //vec3 terrain_color = texture(color_map, uv).rgb;\n        //color = texture(normal_map, uv).rgb;\n        color = clamp(getLighting() + 0.1, 0.0, 1.0) * terrain_color;\n        //color = texture(height_map, uv).rgb;\n    }\n\n    frag_color = vec4(color, 1.0);\n}\n"}}]);